<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://ifuryst.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://ifuryst.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-02-13T01:45:12+00:00</updated><id>https://ifuryst.github.io/feed.xml</id><title type="html">ifuryst</title><subtitle>ğŸ“ &amp; ğŸ’­ </subtitle><entry><title type="html">AIåœ¨å¹¿å‘Šçš„åº”ç”¨</title><link href="https://ifuryst.github.io/blog/2025/ai-in-ads/" rel="alternate" type="text/html" title="AIåœ¨å¹¿å‘Šçš„åº”ç”¨"/><published>2025-02-13T00:30:27+00:00</published><updated>2025-02-13T00:30:27+00:00</updated><id>https://ifuryst.github.io/blog/2025/ai-in-ads</id><content type="html" xml:base="https://ifuryst.github.io/blog/2025/ai-in-ads/"><![CDATA[<p>ä»Šå¤©åœ¨Newsletteré‡Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç»äº† Pinterest å¦‚ä½•å°† AI åº”ç”¨äºäº§å“å’Œä¸šåŠ¡ï¼Œå°¤å…¶æ˜¯åœ¨å¹¿å‘ŠæœåŠ¡ï¼ˆadsï¼‰ä¸­çš„åº”ç”¨ã€‚Pinterest é€šè¿‡ AI ä¸ªæ€§åŒ–å®šåˆ¶ç”¨æˆ·æ‰€çœ‹åˆ°çš„å†…å®¹ï¼Œæ ¹æ®ç”¨æˆ·å–œå¥½è‡ªåŠ¨ç”ŸæˆèƒŒæ™¯å›¾ç­‰ç´ æï¼Œä»è€Œæå‡å¹¿å‘Šæ•ˆæœã€‚ä¾‹å¦‚ï¼Œä¸€äº›ä¿å¥å“æˆ–è¯å“é”€å”®å•†å¯ä»¥åˆ©ç”¨ AI æŠ€æœ¯ï¼Œæ›´ç²¾å‡†åœ°é’ˆå¯¹ç›®æ ‡ç”¨æˆ·ç¾¤ä½“ç”Ÿæˆå’Œæ¨é€å¹¿å‘Šï¼Œæé«˜è½¬åŒ–ç‡</p> <p>ä¸ªæ€§åŒ–å¹¿å‘ŠæŠ•æ”¾æ— ç–‘æ˜¯æœªæ¥çš„é‡è¦å‘å±•æ–¹å‘ã€‚é™¤äº† Pinterestï¼ŒMetaå’Œ Google ä¹‹ç±»çš„å…¬å¸ä¹Ÿåœ¨ç§¯ææ¢ç´¢ AI åœ¨å¹¿å‘Šæ¨å¹¿ä¸­çš„åº”ç”¨ã€‚ç›®å‰ï¼Œè¿˜æ²¡æœ‰å“ªå®¶å…¬å¸èƒ½å®Œå…¨æŒæ¡ AI å¹¿å‘Šçš„æœ€ä½³å®è·µã€‚å„å…¬å¸æˆ–å¹³å°è¿˜æ˜¯éœ€è¦ç»“åˆè‡ªèº«çš„äº§å“ã€å†…å®¹å’Œå—ä¼—ç‰¹ç‚¹ï¼Œå®šåˆ¶åŒ–åœ°å°† AI èå…¥å¹¿å‘Šç³»ç»Ÿï¼Œæ‰èƒ½æœ€å¤§åŒ–AIä¸ºå¹¿å‘Šæ¨é€å¸¦æ¥æ›´å¤§çš„æ•ˆç›Š</p> <p>ä¼ ç»Ÿå¹¿å‘ŠæŠ•æ”¾å¾€å¾€éœ€è¦å¹¿å‘Šä¸»å‡†å¤‡å¤§é‡çš„ç´ æï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡ˆç­‰ï¼‰ï¼Œä½† AI å¯ä»¥å¸®åŠ©å¹¿å‘Šä¸»åœ¨ä¿æŒåŸæœ‰ç´ æçš„åŸºç¡€ä¸Šï¼Œç”šè‡³ä½¿ç”¨æ›´å°‘çš„ç´ æï¼Œç”Ÿæˆæ›´ç¬¦åˆç›®æ ‡ç”¨æˆ·éœ€æ±‚çš„å¹¿å‘Šå†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¹¿å‘Šä¸»é’ˆå¯¹å¹´è½»çš„å…»å® ç‰©ç¾¤ä½“æŠ•æ”¾ç‹—ç²®æˆ–çŒ«ç²®å¹¿å‘Šï¼ŒAI å¯ä»¥åŸºäºäº§å“ç†å¿µã€è¯´æ˜ä¹¦ã€è§„æ ¼ç­‰ä¿¡æ¯ï¼Œè‡ªåŠ¨ç”Ÿæˆé€‚åˆè¯¥ç¾¤ä½“çš„å›¾æ–‡æˆ–è§†é¢‘å¹¿å‘Šï¼Œè€Œæ— éœ€å¹¿å‘Šä¸»é¢å¤–èŠ±è´¹å¤§é‡ç²¾åŠ›åˆ¶ä½œæ–°ç´ æã€‚å¦å¤–AI ä¹Ÿä¸ä¸€å®šè¦ä¸ºæ¯ä¸ªç”¨æˆ·å•ç‹¬ç”Ÿæˆå†…å®¹ï¼Œè€Œæ˜¯å¯ä»¥é’ˆå¯¹æŸä¸€ç±»ç”¨æˆ·ç¾¤ä½“ï¼Œè‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„å¹¿å‘Šå±•ç¤ºç´ æï¼Œä»è€Œæå‡å¹¿å‘ŠæŠ•æ”¾çš„æ•ˆç‡ã€‚è¿™äº›æ— ç–‘éƒ½æ˜¯æœªæ¥å¹¿å‘Šé¢†åŸŸå¯è§çš„ä¸€äº›æ–¹å‘ã€‚</p> <p>ä¸è¿‡AI åœ¨å¹¿å‘Šä¸­çš„åº”ç”¨ä¹Ÿé¢ä¸´äº†ä¸€äº›æŒ‘æˆ˜ï¼Œæ¯”å¦‚æ¨¡å‹çš„å‡†ç¡®æ€§ã€å†…å®¹çš„å¯ä¿¡åº¦ï¼Œä»¥åŠå¯èƒ½å‡ºç°çš„å¹»è§‰ç­‰é—®é¢˜ã€‚ä¸è¿‡æˆ‘è¿˜æ˜¯ç›¸ä¿¡éšç€å¤§æ¨¡å‹çš„æˆæœ¬ä¸‹é™ã€æ•ˆæœæå‡å’Œä¸€äº›æ–°çš„æŠ€æœ¯æ¼”è¿›ï¼Œè¿™äº›é—®é¢˜èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³ï¼Œæœ€ç»ˆèƒ½å¦å®Œå…¨è§£å†³ï¼Œä»ç„¶å–å†³äºå·¥ç¨‹åŒ–çš„ç»“åˆå’ŒæŠ€æœ¯çš„æŒç»­å‘å±•ã€‚</p> <p>ä»æ›´å®è§‚çš„è§’åº¦æ¥çœ‹ï¼Œä¼ ç»Ÿè®¡ç®—æœºæŠ€æœ¯ä¾èµ–ç¡®å®šæ€§ï¼Œä¾‹å¦‚ 1+1=2ï¼Œæ­£æ˜¯è¿™ç§ç¡®å®šæ€§å¥ å®šäº†è®¡ç®—æœºæŠ€æœ¯é•¿æœŸå‘å±•çš„åŸºç¡€ã€‚ä½†æ˜¯åœ¨AIæ—¶ä»£ï¼Œ æŠ€æœ¯æœ¬è´¨ä¸Šå¹¶éæ˜¯ç¡®å®šæ€§çš„æ€§è´¨ï¼Œè€Œæ˜¯æ›´å…·è¯­ä¹‰åŒ–ç‰¹å¾ï¼Œç±»ä¼¼äºäººç±»çš„è¯­è¨€è¡¨è¾¾â€”â€”åŒä¸€ä¸ªæ„æ€å¯ä»¥æœ‰å¤šç§ä¸åŒçš„è¡¨è¾¾æ–¹å¼ã€‚åœ¨è¿™æ ·çš„æ¡†æ¶ä¸‹ï¼Œåç»­ä¸èƒ½è¿‡åº¦è¿½æ±‚ AI ç”Ÿæˆå†…å®¹çš„ç¡®å®šæ€§ï¼Œæˆ–è®¸ä»¥æœ€ç»ˆçš„å®é™…æ•ˆæœä¸ºå¯¼å‘æ˜¯æ›´å¥½çš„æ€ç»´å’Œå®è·µæ–¹å¼ã€‚åƒç‰¹æ–¯æ‹‰çš„è‡ªåŠ¨é©¾é©¶é‡‡ç”¨ç«¯åˆ°ç«¯ AI æ¨¡å‹ï¼Œè™½ç„¶æ— æ³•ç²¾ç¡®é¢„æµ‹æ¯ä¸€æ­¥çš„è¾“å‡ºï¼Œä½†èƒ½ç¡®ä¿æœ€ç»ˆçš„é©¾é©¶è¡Œä¸ºç¬¦åˆé¢„æœŸã€‚è¿™æˆ–è®¸ä»£è¡¨äº†ä¸€ç§æ€ç»´æ¨¡å¼çš„è½¬å˜ï¼Œå³æˆ‘ä»¬åº”è¯¥æ›´åŠ å…³æ³¨ AI ç³»ç»Ÿçš„æœ€ç»ˆç»“æœï¼Œè€Œéå•ä¸€è¿‡ç¨‹çš„ç¡®å®šæ€§ã€‚</p>]]></content><author><name></name></author><category term="insights"/><category term="insights"/><summary type="html"><![CDATA[ä»Šå¤©åœ¨Newsletteré‡Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç»äº† Pinterest å¦‚ä½•å°† AI åº”ç”¨äºäº§å“å’Œä¸šåŠ¡ï¼Œå°¤å…¶æ˜¯åœ¨å¹¿å‘ŠæœåŠ¡ï¼ˆadsï¼‰ä¸­çš„åº”ç”¨ã€‚Pinterest é€šè¿‡ AI ä¸ªæ€§åŒ–å®šåˆ¶ç”¨æˆ·æ‰€çœ‹åˆ°çš„å†…å®¹ï¼Œæ ¹æ®ç”¨æˆ·å–œå¥½è‡ªåŠ¨ç”ŸæˆèƒŒæ™¯å›¾ç­‰ç´ æï¼Œä»è€Œæå‡å¹¿å‘Šæ•ˆæœã€‚ä¾‹å¦‚ï¼Œä¸€äº›ä¿å¥å“æˆ–è¯å“é”€å”®å•†å¯ä»¥åˆ©ç”¨ AI æŠ€æœ¯ï¼Œæ›´ç²¾å‡†åœ°é’ˆå¯¹ç›®æ ‡ç”¨æˆ·ç¾¤ä½“ç”Ÿæˆå’Œæ¨é€å¹¿å‘Šï¼Œæé«˜è½¬åŒ–ç‡]]></summary></entry><entry><title type="html">Congrats on ICLR 2025!</title><link href="https://ifuryst.github.io/blog/2025/congrats-on-iclr-2025/" rel="alternate" type="text/html" title="Congrats on ICLR 2025!"/><published>2025-02-11T14:22:27+00:00</published><updated>2025-02-11T14:22:27+00:00</updated><id>https://ifuryst.github.io/blog/2025/congrats-on-iclr-2025</id><content type="html" xml:base="https://ifuryst.github.io/blog/2025/congrats-on-iclr-2025/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2025-02-11-congrats-on-iclr-2025/iclr2025-480.webp 480w,/assets/img/2025-02-11-congrats-on-iclr-2025/iclr2025-800.webp 800w,/assets/img/2025-02-11-congrats-on-iclr-2025/iclr2025-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2025-02-11-congrats-on-iclr-2025/iclr2025.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> Paper on ICLR 2025. </div> <p><a href="https://github.com/All-Hands-AI/OpenHands">OpenHandsï¼ˆå‰OpenDevinï¼‰</a>çš„è®ºæ–‡è¢«ICLR 2025æ¥å—å•¦ğŸ‰</p> <p>ç°åœ¨å·²ç»45Kçš„StartğŸŒŸï¼Œ5Kçš„Forkï¼Œæ—¶å…‰èè‹’å•Šã€‚ä¼šæƒ³å»å¹´å’Œå¤§å®¶ä¸€èµ·å†™Paperï¼Œè·‘Benchmarkï¼ŒçœŸå®æ˜¯ä¸€ç¯‡æ•´ä¸ªç¤¾åŒºè´¡çŒ®çš„paperï¼Œæ„Ÿè§‰å¾ˆæ£’ã€‚</p> <p>è¿™ä¸ªé‚®ä»¶ä¹Ÿæ ‡å¿—ç€æˆ‘æ…¢æ…¢çš„ä»è¿™ä¸ªé¡¹ç›®æ·¡å‡ºäº†ï¼Œ2024å¹´ä¸ŠåŠå¹´èŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨è¿™ä¸ªé¡¹ç›®é‡Œè´¡çŒ®å’Œç»“å®ä¸€äº›ä¼˜ç§€çš„äººï¼Œç°åœ¨æˆ‘æœ‰æ›´å¤šæˆ‘æƒ³åšçš„äº‹æƒ…ï¼Œæˆ‘æ…¢æ…¢çš„ä»è¿™ä¸ªé¡¹ç›®é‡Œèµ°å¼€äº†ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ— å¯åšéï¼Œäººç”Ÿå°±æ˜¯è¿™æ ·ä¸€æ®µåˆä¸€æ®µçš„ç»å†ç»„æˆï¼Œæ‰æˆå°±äº†ç°åœ¨çš„æˆ‘ä»¬ã€‚ç¥æ„¿è¿˜åœ¨é¡¹ç›®é‡Œæ´»è·ƒçš„ä¼™ä¼´ä»¬èƒ½è¶Šèµ°è¶Šè¿œï¼Œä¸å¿˜åˆå¿ƒã€‚</p>]]></content><author><name></name></author><category term="Life"/><category term="Life"/><summary type="html"><![CDATA[Paper on ICLR 2025.]]></summary></entry><entry><title type="html">Back Online! Letâ€™s Rock 2025</title><link href="https://ifuryst.github.io/blog/2025/lets-rock-2025/" rel="alternate" type="text/html" title="Back Online! Letâ€™s Rock 2025"/><published>2025-02-11T14:12:27+00:00</published><updated>2025-02-11T14:12:27+00:00</updated><id>https://ifuryst.github.io/blog/2025/lets-rock-2025</id><content type="html" xml:base="https://ifuryst.github.io/blog/2025/lets-rock-2025/"><![CDATA[<p>æ˜¥èŠ‚å»ç¾å›½ç©äº†åŠä¸ªæœˆï¼Œç¬¬ä¸€æ¬¡å»ç¾å›½ï¼Œè¿™æ¬¡æ—…ç¨‹æœ‰å¾ˆå¤šæ”¶è·ï¼Œæ„Ÿè§‰æˆé•¿äº†å¾ˆå¤šï¼Œåç»­æœ‰ç©ºå†å±•å¼€ä»”ç»†è¯´è¯´è¿™æ¬¡ç¾å›½ä¹‹è¡Œçš„ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ã€‚è¿™æ¬¡åŠä¸ªæœˆï¼Œç®—æ˜¯Going Offlineäº†åŠä¸ªæœˆï¼Œä¸€å¹´æœ‰è¿™æ ·çš„ä¸€æ®µæ—¶é—´è¿˜æŒºå¥½çš„ã€‚</p> <p>æˆ‘ä»ç¾å›½èƒŒå›æ¥å‡ æœ¬ä¹¦ï¼Œè·¯ä¸Šå°±åœ¨çœ‹The Nvidia Wayï¼Œä»¥å‰ä¹Ÿçœ‹è¿‡ç±»ä¼¼è¿™ç§å…¬å¸æˆ–è€…ä¸ªäººçš„æˆé•¿è®°å½•ï¼Œä½†æ˜¯è¿™æ¬¡æ„å¤–çš„æœ‰å¾ˆå¤šæ„Ÿå—ï¼Œä¹Ÿåšå®šäº†ä¸€äº›æˆ‘ä¹‹å‰çš„æƒ³æ³•å’Œè¡Œä¸ºã€‚</p> <p>ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ ‡é¢˜å‘¢ï¼Œä¸€ä¸ªæ˜¯è·Ÿå¤§å®¶è¯´æˆ‘åœ¨çº¿äº†ï¼Œå¯ä»¥ç»§ç»­å¼€å¹²äº†ï¼Œå¦å¤–ä¸€å¥æ˜¯åšå®šäº†2025æˆ‘ä¼šç»§ç»­æŒ‰ç…§æˆ‘çš„èŠ‚å¥å¾€å‰çªè¿›ã€‚ä»Šå¤©æœ‰ä¸ªç½‘å‹walkerç»™æˆ‘å†™é‚®ä»¶æ‰¾æˆ‘äº¤æµäº†æ— èŠçš„ä¸–ç•Œï¼Œåœ¨æˆ‘ç»™ä»–çš„å›ä¿¡ä¸­æˆ‘å†™åˆ°äº†è¿™æ ·ä¸€æ®µè¯ï¼š</p> <blockquote> <p>æˆ‘è§‰å¾—è¿™ä¸¤å¹´ä¼¼ä¹ç«™åœ¨äº†ä¸€ä¸ªæ—¶ä»£å˜é©çš„èŠ‚ç‚¹ï¼Œæˆ‘è¿˜æ˜¯æŒºç›¸ä¿¡AIèƒ½ç»™è¿™ä¸ªç¤¾ä¼šå’Œä¸ªäººå¸¦æ¥å¾ˆå¤šä»·å€¼çš„ï¼Œä»Šå¤©çœ‹newsletterï¼Œé‡Œé¢æœ‰è¯´åˆ°æœªæ¥å¯èƒ½ä¼šå‡ºç°ä¸€äººçš„ç‹¬è§’å…½å…¬å¸ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯æœ‰ä¸€å®šçš„å¯èƒ½çš„ã€‚ä»¥å‰è¯´é€†æ°´è¡ŒèˆŸä¸è¿›åˆ™é€€ï¼Œç°åœ¨æˆ‘å€’æ˜¯æ„Ÿè§‰åœ¨æ—¶ä»£çš„é•¿æ²³é‡Œï¼Œæˆ‘ä»¬ä¸æ˜¯é€†æµï¼Œåªæ˜¯æ°´æµçš„é€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œå¦‚æœæˆ‘ä»¬ä¸€ç›´ä»¥ä¸€æ ·çš„é€Ÿåº¦å‰è¡Œï¼Œç›¸å¯¹è€Œè¨€æˆ‘ä»¬å°±æ˜¯ä¸€ç›´åœ¨å¾€åèµ°ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶ä»£å‘Šè¯‰å˜åŒ–æœ¬èº«å°±ç»™ä¸æ–­å‘å‰çš„äººä¸€äº›æ— å½¢çš„å‹åŠ›ï¼Œæœ‰ä¸€ç‚¹åƒæ˜¯çˆ±ä¸½ä¸æ¢¦æ¸¸ä»™å¢ƒé‡Œé‚£ä¸ªæ„æ€äº†ï¼Œæˆ‘ä»¬åŠªåŠ›å¥”è·‘åªæ˜¯ä¸ºäº†ç•™åœ¨åŸåœ°ã€‚å¸Œæœ›ä¸è¦è¢«æ—¶ä»£æŠ›ä¸‹å•Š</p> </blockquote> <p>ä»£è¡¨äº†æˆ‘çš„ä¸€éƒ¨åˆ†æƒ³æ³•ã€‚AIæ—¶ä»£ï¼Œæ¯ä¸ªäººçš„è¾¹ç•Œéƒ½æå¤§æ‰©å¤§äº†ï¼Œæœ¬æ¥ä¸å¤ªå¯èƒ½çš„ä¸œè¥¿ä¹Ÿå˜å¾—æ›´åŠ æœ‰å¯èƒ½äº†ï¼Œæˆ‘åšä¿¡AIå¿…å®šèƒ½å¸¦æˆ‘å»åˆ°æ›´é«˜çš„åœ°æ–¹</p> <p>æ•´ä¸ª2024æˆ‘çš„æ”¶è·å¤§åˆ°å¯æ€•ï¼Œæˆ‘å¸Œæœ›2025è¿˜èƒ½ç”¨è¿™æ ·çš„é€Ÿåº¦ç»§ç»­å‰è¿›ï¼Œä¹ŸæœŸå¾…å’Œä¸€äº›æœ‰æƒ³æ³•çš„äººå¤šèŠèŠï¼Œä¸æ–­æ˜¯åŒè¡Œè¿˜æ˜¯å„è¡Œå„ä¸šçš„è€æ¿æˆ–è€…æ˜¯è¿œåœ¨å›½å¤–çš„å‹äººã€‚æ–°çš„ä¸€å¹´ï¼ŒLetâ€™s Rock! ğŸª¨</p>]]></content><author><name></name></author><category term="Life"/><category term="Life"/><summary type="html"><![CDATA[æ˜¥èŠ‚å»ç¾å›½ç©äº†åŠä¸ªæœˆï¼Œç¬¬ä¸€æ¬¡å»ç¾å›½ï¼Œè¿™æ¬¡æ—…ç¨‹æœ‰å¾ˆå¤šæ”¶è·ï¼Œæ„Ÿè§‰æˆé•¿äº†å¾ˆå¤šï¼Œåç»­æœ‰ç©ºå†å±•å¼€ä»”ç»†è¯´è¯´è¿™æ¬¡ç¾å›½ä¹‹è¡Œçš„ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ã€‚è¿™æ¬¡åŠä¸ªæœˆï¼Œç®—æ˜¯Going Offlineäº†åŠä¸ªæœˆï¼Œä¸€å¹´æœ‰è¿™æ ·çš„ä¸€æ®µæ—¶é—´è¿˜æŒºå¥½çš„ã€‚]]></summary></entry><entry><title type="html">My 2024 Recap ğŸ’«</title><link href="https://ifuryst.github.io/blog/2024/my-2024-recap/" rel="alternate" type="text/html" title="My 2024 Recap ğŸ’«"/><published>2024-12-26T15:43:27+00:00</published><updated>2024-12-26T15:43:27+00:00</updated><id>https://ifuryst.github.io/blog/2024/my-2024-recap</id><content type="html" xml:base="https://ifuryst.github.io/blog/2024/my-2024-recap/"><![CDATA[<p>ä»Šå¹´æŒºç²¾å½©çš„ï¼Œä»ä¸–ç•Œçš„è§’åº¦æˆ–è€…ä¸ªäººçš„è§’åº¦ï¼Œæˆ‘è§‰å¾—éƒ½å€¼å¾—å›é¡¾ä¸€ä¸‹</p> <p>ä¸€æ™ƒå·²æ˜¯New Yrï¼Œä»Šå¹´å‘ç”Ÿäº†è¿˜å¤šäº‹æƒ…å•Šï¼Œæ›´åŠ å……å®ã€è‡ªæˆ‘æå‡çš„ä¸€å¹´ï¼Œæˆ‘è¿˜æŒºæ»¡æ„çš„ï¼Œè™½ç„¶æœ‰é‚£ä¹ˆå‡ å¤©å› ä¸ºèº«ä½“ç¼˜æ•…æ„Ÿè§‰åˆ°å¾ˆç´¯ï¼Œä½†æ˜¯æ•´ä½“è¿˜æ˜¯å¾ˆNiceçš„ã€‚</p> <p>ä»Šå¹´ç®—æ˜¯æ­£å¼å¼€å§‹æ¥è§¦LLMçš„ä¸€å¹´ï¼Œä¹Ÿæ˜¯ä»Šå¹´å¹´åˆå¼€å§‹å¤§é‡å¼€å§‹æŠ•å…¥åˆ°AIåº”ç”¨çš„ç ”å‘ï¼Œé¦–å…ˆæ˜¯æœ‰å¹¸å‚ä¸äº†OpenDevinï¼ˆå…ˆå·²æ›´åä¸ºOpenHandsï¼Œæˆªæ­¢ç›®å‰å·²æœ‰39Kâ­ï¸ï¼‰ä»æœ€å¼€å§‹çš„å‚ä¸è€…ï¼Œåˆ°æˆä¸ºMaintainerï¼Œå†åˆ°åæ¥Robertã€Xingyaoå’ŒGrahamä»–ä»¬æˆç«‹All Hands AIï¼Œä»¥åŠåœ¨éšåçš„æ—¶é—´å†…æ‹‰åˆ°$5Mçš„èèµ„ï¼Œè™½ç„¶æœ‰ç‚¹å°é—æ†¾æ²¡æœ‰åŠæ³•åŠ å…¥ä»–ä»¬ä¸€èµ·å¥‹æ–—ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆé«˜å…´è¿™ä¸€è·¯æ¥çš„å†ç¨‹ï¼Œè§è¯†åˆ°äº†å¥½å¤šç‰›é€¼çš„äººï¼Œä¼ä¸šå±‚é¢æœ‰å­—èŠ‚ã€å¾®è½¯ã€é˜¿é‡Œçš„ï¼Œå­¦æ ¡å±‚é¢æœ‰CMUã€UIUCç­‰ï¼Œå›½å®¶æ›´æ˜¯è·¨è¶Šå‡ ä¹æ¯ä¸ªå¤§æ´²äº†ã€‚ç£•ç£•ç¢°ç¢°å’Œå¤§å®¶ç”¨è‹±è¯­äº¤æµï¼Œä¹Ÿå­¦ä¼šäº†å¾ˆå¤šé»‘è¯ï¼Œæ˜¯éå¸¸æ£’çš„ä¸€æ®µç»å†ã€‚Keep Engaging.</p> <p>åæ¥ä¹Ÿé™†ç»­å’Œå‡ ä½å°ä¼™ä¼´å¼€å‘å‡ºäº†ä¸€ä¸‹æœ‰è¶£çš„AIåº”ç”¨ï¼Œè¿™ä¸€å—ä¹Ÿå°†æˆ‘çš„ä¸šä½™æ—¶é—´ç‡ƒçƒ§æ‰ä¸€å¤§éƒ¨åˆ†ã€‚è¿™å—ä¹Ÿå°†æ˜¯åç»­ä¼šæŒç»­æŠ•å…¥çš„é¢†åŸŸï¼Œæˆ‘è§‰å¾—AIè¿œä¸æ­¢äºæ­¤ï¼Œè¿˜æœ‰å¾ˆå¤šæœºä¼šçš„ã€‚ä»Šå¹´è·Ÿèµ„è®¯è·Ÿå¾—å¾ˆå‹¤ï¼Œå‡ ä¹æ¯å¤©éƒ½å¯ä»¥çœ‹åˆ°æœ‰æ–°çš„LLM Related Projectså‡ºæ¥ï¼Œæ¯å¤©éƒ½æœ‰æ–°çš„Paperï¼Œæ¯å¤©éƒ½æœ‰èèµ„æ–°é—»ï¼Œæ¯å¤©éƒ½æœ‰å„ç§AIæ–°é—»ã€‚è¿™ç§çŠ¶å†µæ˜¯æˆ‘ä»æ²¡è§è¿‡çš„ï¼Œå ªæ¯”äº’è”ç½‘æµªæ½®ï¼Œæœ‰ç‚¹09å¹´æ—¶å€™çš„æ„Ÿè§‰äº†ï¼Œä¸€åˆ‡éƒ½æ˜¯æ–°é²œçš„ï¼Œä¹Ÿæœ‰ä¸€ç¾¤åœ¨æ–°ä¸–ç•Œæ¢ç´¢çš„äººã€‚Keep Doing.</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-12-26-my-2024-recap/medium-well-pls-480.webp 480w,/assets/img/2024-12-26-my-2024-recap/medium-well-pls-800.webp 800w,/assets/img/2024-12-26-my-2024-recap/medium-well-pls-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-12-26-my-2024-recap/medium-well-pls.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> Medium Well Please </div> <p>ä»Šå¹´ä¹Ÿæ˜¯å­¦ä¹ çš„ä¸€å¹´ï¼Œæ¯ä¸ªå·¥ä½œæ—¥éƒ½ç»ƒå£è¯­è¿™ä»¶äº‹æˆ‘ç¡®å®æ˜¯è®¤çœŸçš„ï¼Œä¸€å¹´å¤šäº†ï¼Œ å¦‚æœç”¨æˆ‘pyqå‘çš„è¿™å¼ ç‰›æ’ç†Ÿåº¦æ¥è¯´çš„è¯ï¼Œä¿å®ˆä¸€ç‚¹ç›®å‰åº”è¯¥èƒ½åˆ°medium-rareäº†ï¼ŒChatGPTæ°¸è¿œæ˜¯æˆ‘æœ€æœ€æ£’çš„partnerã€‚ä»Šå¹´ä¹Ÿé™†ç»­çœ‹äº†ä¸€å †è‹±è¯­ä¹¦ï¼Œè·Ÿæµ·ç»µä¸€æ ·æ¯å¤©ä¼šå¸çº³å¾ˆå¤šè‹±æ–‡æ–°é—»å’ŒPodcastï¼Œè¾“å…¥å’Œè¾“å‡ºå…¼é¡¾ï¼Œè¿˜æ˜¯èƒ½æœ‰å¾ˆå¥½çš„æå‡ï¼Œä¸è¿‡æˆ‘æ„Ÿè§‰è¿˜æ˜¯ä¸å¤Ÿç”¨å¿ƒçš„å»craftå¦‚ä½•æå‡çš„è·¯å¾„ï¼Œä¸è¿‡æˆ‘å€’æ˜¯è§‰å¾—ä¸å…¶æŒ–ç©ºå¿ƒæ€å»è€ƒè™‘è¿™äº›ï¼Œå€’ä¸å¦‚ç”¨è‡ªå·±æ›´èƒ½æ¥å—çš„è½»æ¾æ–¹å¼ï¼Œç„¶åå»åšæŒï¼Œæœ‰æ•ˆçš„åšæŒå¿…ç„¶ä¼šæœ‰æ”¶è·çš„ã€‚é©¬ä¸Šå°±è¦å»ğŸ‡ºğŸ‡¸äº†ï¼Œå¯ä»¥å†æ¬¡å®è·µè‡ªå·±çš„å£è¯­èƒ½åŠ›äº†ã€‚Keep Practising.</p> <p>ä»Šå¹´ä¹Ÿä»GitHubæ”¶åˆ°äº†å¥½å¤šäººå‘é‚®ä»¶ç»™æˆ‘ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯å·¥ä½œæœºä¼šï¼Œå¾ˆå¤šæ˜¯ä»ğŸ‡ºğŸ‡¸çš„startupæ‰¾æ¥çš„ï¼Œæˆ‘è§‰å¾—è¿˜è›®æƒŠå–œçš„ï¼Œä¹ŸæŒºé«˜å…´çš„ï¼ŒåŸæ¥æ¢å¤å†™blogçš„ä¸€ä¸ªåŸå› å°±æ˜¯æˆ‘ä¸å¸Œæœ›åˆ«äººæ˜¯é€šè¿‡æˆ‘çš„å±¥å†æ¥äº†è§£å®šæ€§æˆ‘ï¼Œæˆ‘å¸Œæœ›èƒ½é€šè¿‡å­—é‡Œè¡Œé—´ä»¥åŠæˆ‘åœ¨åšçš„äº‹æƒ…ï¼Œæ¥è®©æœ‰å…´è¶£çš„äººæ„Ÿå—åˆ°æˆ‘æ˜¯ä»€ä¹ˆæ ·çš„äººï¼Œæˆ‘è§‰å¾—è¿™èƒ½å‡å°‘å¾ˆå¤šçš„è¯¯è§£å’Œæ‘©æ“¦ï¼Œä¸è¿‡æ˜¯æä¾›å·¥ä½œæœºä¼šè¿˜æ˜¯æœ‰æŠ€æœ¯ã€é¡¹ç›®çš„äº¤æµã€‚æˆ‘ä¹Ÿå†™äº†ç¬¬ä¸€ä»½å…¨è‹±Resumeï¼Œç¬¬ä¸€æ¬¡ä½“éªŒå…¨è‹±æ–‡é¢è¯•ï¼Œè¯´ä¸æ…Œæ˜¯ä¸å¯èƒ½çš„ï¼Œå£åèŠ¬èŠ³äº†å·²ç»ã€‚æ˜å¹´ä¹Ÿä¼šåšæŒåœ¨è¿™å—åšè¾“å‡ºï¼Œæˆ‘è§‰å¾—å¾ˆå¤šæ—¶å€™è‡ªå·±åšçš„æ²¡æœ‰å»å›é¡¾ï¼Œå»å¤ç›˜ï¼Œå»æ€»ç»“ï¼Œè¿‡æ®µæ—¶é—´å°±å¿˜è®°äº†ï¼Œæœ‰äº›å¾ˆä¸é”™çš„æƒ³æ³•ã€ç»éªŒï¼Œè¿™æ ·æµé€æ‰äº†è¿˜æŒºå¯æƒœçš„ã€‚Keep Fighting.</p> <p>æé™è¿åŠ¨ç¡®å®ä¸å¤ªé€‚åˆæˆ‘ï¼Œç”šè‡³è¿‡å±±è½¦ä¹Ÿåä¸äº†ä¸€ç‚¹äº†ï¼Œä»Šå¹´è¿˜æ˜¯å»ğŸ‡°ğŸ‡·ç©äº†ä¸€ä¸‹ï¼ˆç¬¬ä¸€æ¬¡å»éè‹±è¯­å›½å®¶ï¼Œçªç„¶å°±æ˜ç™½è±¡å½¢å­—æœ‰å¤šéš¾é¡¶ï¼‰ï¼Œé¡ºä¾¿å°è¯•äº†æ»‘é›ªï¼Œç®€å•è¯´å°±æ˜¯ä»æ—©ä¸Šæ‘”åˆ°æ™šä¸Šå§ï¼Œè†ç›–å’Œå±è‚¡ä¸å¤ªè¡Œäº†ï¼Œä¸è¿‡æˆ‘è¿˜æŒºå–œæ¬¢æ»‘é›ªçš„ï¼Œæˆ‘è§‰å¾—ç­‰æˆ‘è§‰å¾—è‡ªå·±å¯ä»¥ä¸é‚£ä¹ˆæ‹¼çš„æ—¶å€™ï¼Œæˆ‘ä¼šè€ƒè™‘è®¤çœŸå»å­¦ä¸€ä¸‹æ»‘é›ªï¼Œç„¶åå»é˜¿å°”å‘æ–¯æ»‘ä¸€æ¬¡ï¼Œä¸€å¼€å§‹æˆ‘è§‰å¾—å•æ¿ğŸ‚æ¯”è¾ƒé…·ï¼Œä½†æ˜¯åœ¨æ·±å…¥äº†è§£äº†æ»‘é›ªæ–‡åŒ–å’Œä¸€äº›äººçš„æ•…äº‹ï¼Œæˆ‘å‘ç°æˆ‘ç°åœ¨åè€Œæ›´å–œæ¬¢åŒæ¿ğŸ¿ï¼Œå°è¯•ä¸€ä¸ªæ–°äº‹ç‰©ï¼Œå¹¶ä¸”å–œæ¬¢ä¸Šï¼Œæ˜¯ä¸€ä»¶å¾ˆæ£’çš„äº‹æƒ…ã€‚Keep Exploring.</p> <p>ä»Šå¹´æˆ‘å¯¹äºç»æµã€é‡‘èæ–¹é¢æœ‰äº†æ›´åŠ æ·±åˆ»çš„ç†è§£ï¼ŒèƒŒæ™¯å½“ç„¶æ˜¯ä¾æ‰˜äºå¤§ç¯å¢ƒä¸‹çš„ç»æµé—®é¢˜ï¼Œä»å†å²çš„è§’åº¦ï¼Œæ›´å®è§‚çš„è§’åº¦æ¥çœ‹ï¼Œä¸ªäººçš„åŠªåŠ›åªèƒ½å†³å®šä¸€å®šèŒƒå›´å†…çš„ä¸œè¥¿ï¼Œåœ¨ç»æµå¥½çš„å¹´ä»£çš„äººå’Œç»æµä¸æ™¯æ°”å¹´ä»£çš„äººï¼Œä¼šæœ‰æˆªç„¶ä¸åŒçš„è§‚ç‚¹å’Œè¡Œä¸ºã€‚åŸºäºè‡ªèº«è¿‡å¾€çš„èµšé’±å’ŒæŠ•èµ„ç»å†æ¥çœ‹ï¼Œæœ‰å¾—æœ‰å¤±ï¼Œç°åœ¨å¯¹äºè´¢åŠ¡æƒ…å†µå’Œèµ„äº§å¤„ç½®æœ‰äº†æ›´é«˜çš„ç†è§£äº†ï¼Œæ¸æ¸æ˜ç™½ï¼Œéšç€é˜…å†å’Œè§è¯†çš„å¢åŠ ï¼Œäººæ˜¯å¯ä»¥å˜å¾—æ›´åŠ ç‰›çš„ï¼ˆè¯æ±‡é‡åŒ®ä¹ï¼Œåæ­£å°±æ˜¯ç‰›å§ï¼‰ã€‚Keep Investing.</p> <p>æˆ‘è¿˜è®°å¾—åœ¨120ä¸ªå­©å­çš„ä¸œåŒ—è€çˆ¸é‡Œçœ‹åˆ°çš„ä¸€å¥è¯ï¼šè‹¥è¦å¦‚ä½•ï¼Œå…¨å‡­è‡ªå·±ã€‚æˆ‘è§‰å¾—è¿™å¥è¯è¿˜æŒºåˆé€‚ç”¨æ¥æ¦‚æ‹¬2024å¹´çš„æˆ‘èƒŒåçš„åŠ¨æœºã€‚å°±åƒè¿œèˆªçš„èˆ¹ï¼Œæœ€æ€•çš„å°±æ˜¯æ²¡æœ‰ç›®æ ‡ã€‚ä¸ç®¡è·¯ä¸Šé‡åˆ°çš„æ˜¯æ»”å¤©å·¨æµªã€ç‹‚é£æš´é›¨æˆ–æ˜¯å¹³é™æ— é£çš„æµ·é¢ï¼Œä¸ç®¡éœ€è¦ç»•è¡Œå¤šè¿œï¼Œç»ˆå°†åˆ°è¾¾çš„ä¸æ˜¯ç”Ÿå‘½çš„ç»ˆç‚¹ï¼Œå°±æ˜¯æ°¸è¿œä¸å¯è§¦è¾¾çš„å­˜åœ¨æ„è¯†å½¢æ€å±‚é¢çš„ç›®æ ‡ã€‚æˆ–è®¸è¿™æ ·çš„ç›®æ ‡å¹¶ä¸å­˜åœ¨ï¼Œä¹Ÿæ°¸è¿œä¸å¯åˆ°è¾¾ï¼Œä½†è¿™æˆ–è®¸ä¹Ÿæ˜¯ä¸€ç§ä»æ…ˆï¼Œæˆ‘ä¸æ€•ç›®æ ‡ä¸å¯è¾¾ï¼Œæ€•çš„æ˜¯è¾¾åˆ°åçš„è¿·èŒ«</p>]]></content><author><name></name></author><category term="Life"/><category term="Life"/><summary type="html"><![CDATA[ä»Šå¹´æŒºç²¾å½©çš„ï¼Œä»ä¸–ç•Œçš„è§’åº¦æˆ–è€…ä¸ªäººçš„è§’åº¦ï¼Œæˆ‘è§‰å¾—éƒ½å€¼å¾—å›é¡¾ä¸€ä¸‹]]></summary></entry><entry><title type="html">Default Ingress Class</title><link href="https://ifuryst.github.io/blog/2024/default-ingress-class/" rel="alternate" type="text/html" title="Default Ingress Class"/><published>2024-12-19T14:47:27+00:00</published><updated>2024-12-19T14:47:27+00:00</updated><id>https://ifuryst.github.io/blog/2024/default-ingress-class</id><content type="html" xml:base="https://ifuryst.github.io/blog/2024/default-ingress-class/"><![CDATA[<p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯Ingressé…ç½®é”™è¯¯é—®é¢˜å¯¼è‡´äº†åˆ°Ingressçš„æµé‡å§‹ç»ˆæ— æ³•æµåˆ°å¯¹åº”çš„Service</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">playground</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">host</span><span class="pi">:</span> <span class="s">api-test.ifuryst.com</span>
      <span class="na">http</span><span class="pi">:</span>
        <span class="na">paths</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">backend</span><span class="pi">:</span>
              <span class="na">serviceName</span><span class="pi">:</span> <span class="s">playground</span>
              <span class="na">servicePort</span><span class="pi">:</span> <span class="m">2112</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/metrics</span>
            <span class="na">pathType</span><span class="pi">:</span> <span class="s">ImplementationSpecific</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">api-test.ifuryst.com</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">api</span>
</code></pre></div></div> <p>é—®é¢˜æ˜¯è¿™æ ·ä¸€ä¸ªIngressé…ç½®ï¼Œçœ‹èµ·æ¥æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¸€ç›´æ²¡ç”Ÿæ•ˆï¼Œä»Serviceèµ°æ˜¯OKçš„ï¼Œè¿™æœŸé—´å…¶å®åå¤ç¡®è®¤å¹¶é‡åšäº†å¥½å‡ æ¬¡ï¼Œä¹Ÿæœ‰åœ¨rancherä¸Šåšï¼Œæœ€åæ‰æ’æŸ¥å®šä½åˆ°æ˜¯å°‘äº†è¿™ä¸ªï¼Œå…¶å®æ ¹æœ¬åŸå› æ˜¯å› ä¸ºé›†ç¾¤æ²¡æœ‰é…ç½®é»˜è®¤çš„IngressClassï¼Œæ‰€ä»¥åœ¨ä¸é…ç½®çš„æƒ…å†µä¹‹ä¸‹æ˜¯ä¸ä¼šèµ°åˆ°Ingressçš„</p> <p>é—®é¢˜æˆ‘è§‰å¾—æ˜¯ä¸ªå°é—®é¢˜ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å»ç¿»çœ‹äº†ä¸€ä¸‹kube-apiserverå’Œingress-nginxçš„ä»£ç ï¼Œè¿™è¾¹é€šè¿‡minikubeç›´æ¥æœ¬åœ°æ‹‰ä¸€ä¸ªé›†ç¾¤è§‚æµ‹ï¼Œè¿™æ ·æœ‰éœ€è¦çš„å¯ä»¥æ ¹æ®å‘½ä»¤è‡ªå·±è·‘æµ‹ä¸€ä¸‹ã€‚</p> <p>å¦å¤–ä¸ºäº†å¯¹æ¯”ï¼Œæˆ‘å¢åŠ å®‰è£…äº†traefikã€‚</p> <p>åˆå§‹åŒ–ç›¸å…³å‘½ä»¤</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># start k8s cluster</span>
<span class="s">minikube start</span>
<span class="c1"># install ingres-nginx</span>
<span class="s">helm upgrade --install ingress-nginx ingress-nginx \</span>
  <span class="s">--repo https://kubernetes.github.io/ingress-nginx \</span>
  <span class="s">--namespace ingress-nginx --create-namespace</span>
<span class="c1"># install trafik</span>
<span class="s">helm repo add traefik https://traefik.github.io/charts</span>
<span class="s">helm repo update</span>
<span class="s">helm install traefik traefik/traefik --namespace traefik --create-namespace</span>
</code></pre></div></div> <p>é€šè¿‡<code class="language-plaintext highlighter-rouge">kubectl get ingressclasses -o yaml</code> å¯ä»¥çœ‹åˆ°ingrss-nginxçš„é…ç½®</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">items</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">IngressClass</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">annotations</span><span class="pi">:</span>
        <span class="na">meta.helm.sh/release-name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">meta.helm.sh/release-namespace</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
      <span class="na">creationTimestamp</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2024-12-04T03:35:34Z"</span>
      <span class="na">generation</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
        <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
        <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">app.kubernetes.io/part-of</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
        <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.11.3</span>
        <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">ingress-nginx-4.11.3</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
      <span class="na">resourceVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">969"</span>
      <span class="na">uid</span><span class="pi">:</span> <span class="s">158fe0a7-0701-45eb-a7f9-e37a5e026afe</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">controller</span><span class="pi">:</span> <span class="s">k8s.io/ingress-nginx</span>
  <span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">IngressClass</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">annotations</span><span class="pi">:</span>
        <span class="na">ingressclass.kubernetes.io/is-default-class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
        <span class="na">meta.helm.sh/release-name</span><span class="pi">:</span> <span class="s">traefik</span>
        <span class="na">meta.helm.sh/release-namespace</span><span class="pi">:</span> <span class="s">traefik</span>
      <span class="na">creationTimestamp</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2024-12-04T03:37:14Z"</span>
      <span class="na">generation</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">traefik-traefik</span>
        <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
        <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">traefik</span>
        <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">traefik-33.0.0</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">traefik</span>
      <span class="na">resourceVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1226"</span>
      <span class="na">uid</span><span class="pi">:</span> <span class="s">98b32f2f-d8a9-47d1-b5f6-bd63e1a01fac</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">controller</span><span class="pi">:</span> <span class="s">traefik.io/ingress-controller</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">List</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">resourceVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div> <p>è¿™è¾¹ä»<code class="language-plaintext highlighter-rouge">ingressclass.kubernetes.io/is-default-class: "true"</code>å…¶å®å¯ä»¥çœ‹å‡ºæ¥ï¼Œingress-nginxé»˜è®¤æ˜¯æ²¡æœ‰å°†è‡ªå·±æå‡ä¸ºé»˜è®¤çš„IngressClassï¼Œè€Œtraefikå´æœ‰ï¼Œæˆ‘ä»¬åˆ°kube-apiserveré‡Œçœ‹ä¸€ä¸‹</p> <p>åœ¨<code class="language-plaintext highlighter-rouge">staging/src/k8s.io/api/networking/v1/well_known_annotations.go</code> å’Œ<code class="language-plaintext highlighter-rouge">staging/src/k8s.io/api/networking/v1beta1/well_known_annotations.go</code> å‡ºç°äº†è¿™ä¸ªé…ç½®ï¼Œè¿™è¾¹æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹v1</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">v1</span>

<span class="k">const</span> <span class="p">(</span>
	<span class="c">// AnnotationIsDefaultIngressClass can be used to indicate that an</span>
	<span class="c">// IngressClass should be considered default. When a single IngressClass</span>
	<span class="c">// resource has this annotation set to true, new Ingress resources without a</span>
	<span class="c">// class specified will be assigned this default class.</span>
	<span class="n">AnnotationIsDefaultIngressClass</span> <span class="o">=</span> <span class="s">"ingressclass.kubernetes.io/is-default-class"</span>
<span class="p">)</span>
</code></pre></div></div> <p>å¯ä»¥çœ‹ä¸‹è°ƒç”¨æ–¹ï¼Œä¸»è¦æ˜¯<code class="language-plaintext highlighter-rouge">plugin/pkg/admission/network/defaultingressclass/admission.go</code> åœ¨è°ƒç”¨</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// getDefaultClass returns the default IngressClass from the store, or nil.</span>
<span class="k">func</span> <span class="n">getDefaultClass</span><span class="p">(</span><span class="n">lister</span> <span class="n">networkingv1listers</span><span class="o">.</span><span class="n">IngressClassLister</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">networkingv1</span><span class="o">.</span><span class="n">IngressClass</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">list</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">lister</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">Everything</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">err</span>
	<span class="p">}</span>

	<span class="n">defaultClasses</span> <span class="o">:=</span> <span class="p">[]</span><span class="o">*</span><span class="n">networkingv1</span><span class="o">.</span><span class="n">IngressClass</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">class</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">list</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">class</span><span class="o">.</span><span class="n">Annotations</span><span class="p">[</span><span class="n">networkingv1</span><span class="o">.</span><span class="n">AnnotationIsDefaultIngressClass</span><span class="p">]</span> <span class="o">==</span> <span class="s">"true"</span> <span class="p">{</span>
			<span class="n">defaultClasses</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">defaultClasses</span><span class="p">,</span> <span class="n">class</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaultClasses</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="no">nil</span>
	<span class="p">}</span>
	<span class="n">sort</span><span class="o">.</span><span class="n">Slice</span><span class="p">(</span><span class="n">defaultClasses</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">defaultClasses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">CreationTimestamp</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">()</span> <span class="o">==</span> <span class="n">defaultClasses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CreationTimestamp</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="n">defaultClasses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span> <span class="o">&lt;</span> <span class="n">defaultClasses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">defaultClasses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">CreationTimestamp</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">defaultClasses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CreationTimestamp</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">()</span>
	<span class="p">})</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaultClasses</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">1</span> <span class="p">{</span>
		<span class="n">klog</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="m">4</span><span class="p">)</span><span class="o">.</span><span class="n">Infof</span><span class="p">(</span><span class="s">"%d default IngressClasses were found, choosing the newest: %s"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaultClasses</span><span class="p">),</span> <span class="n">defaultClasses</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">defaultClasses</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="no">nil</span>
<span class="p">}</span>
</code></pre></div></div> <p>é€šè¿‡listeræ‹¿åˆ°æ‰€æœ‰çš„IngressClassï¼Œåˆ¤æ–­æ˜¯å¦è®¾ç½®äº†<code class="language-plaintext highlighter-rouge">ingressclass.kubernetes.io/is-default-class: "true"</code> ï¼Œå¦‚æœæœ‰å¤šä¸ªå°±æ ¹æ®åˆ›å»ºæ—¶é—´å’Œåç§°æ’åºï¼Œåé¢æ·»åŠ çš„é»˜è®¤IngressClassä¼šå‘½ä¸­ï¼Œå†å¾€ä¸Šçˆ¬ä¸€ä¸‹</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Admit sets the default value of a Ingress's class if the user did not specify</span>
<span class="c">// a class.</span>
<span class="k">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">classDefaulterPlugin</span><span class="p">)</span> <span class="n">Admit</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">attr</span> <span class="n">admission</span><span class="o">.</span><span class="n">Attributes</span><span class="p">,</span> <span class="n">o</span> <span class="n">admission</span><span class="o">.</span><span class="n">ObjectInterfaces</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">GetResource</span><span class="p">()</span><span class="o">.</span><span class="n">GroupResource</span><span class="p">()</span> <span class="o">!=</span> <span class="n">networkingv1</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="s">"ingresses"</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">nil</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">GetSubresource</span><span class="p">())</span> <span class="o">!=</span> <span class="m">0</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">nil</span>
	<span class="p">}</span>

	<span class="n">ingress</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">attr</span><span class="o">.</span><span class="n">GetObject</span><span class="p">()</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">networking</span><span class="o">.</span><span class="n">Ingress</span><span class="p">)</span>
	<span class="c">// if we can't convert then we don't handle this object so just return</span>
	<span class="k">if</span> <span class="o">!</span><span class="n">ok</span> <span class="p">{</span>
		<span class="n">klog</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="o">.</span><span class="n">Infof</span><span class="p">(</span><span class="s">"Expected Ingress resource, got: %v"</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">GetKind</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">NewInternalError</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"Expected Ingress resource, got: %v"</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">GetKind</span><span class="p">()))</span>
	<span class="p">}</span>

	<span class="c">// IngressClassName field has been set, no need to set a default value.</span>
	<span class="k">if</span> <span class="n">ingress</span><span class="o">.</span><span class="n">Spec</span><span class="o">.</span><span class="n">IngressClassName</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">nil</span>
	<span class="p">}</span>

	<span class="c">// Ingress class annotation has been set, no need to set a default value.</span>
	<span class="k">if</span> <span class="n">_</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">ingress</span><span class="o">.</span><span class="n">Annotations</span><span class="p">[</span><span class="n">networkingv1beta1</span><span class="o">.</span><span class="n">AnnotationIngressClass</span><span class="p">];</span> <span class="n">ok</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">nil</span>
	<span class="p">}</span>

	<span class="n">klog</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="m">4</span><span class="p">)</span><span class="o">.</span><span class="n">Infof</span><span class="p">(</span><span class="s">"No class specified on Ingress %s"</span><span class="p">,</span> <span class="n">ingress</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>

	<span class="n">defaultClass</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">getDefaultClass</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">lister</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">admission</span><span class="o">.</span><span class="n">NewForbidden</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="c">// No default class specified, no need to set a default value.</span>
	<span class="k">if</span> <span class="n">defaultClass</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">nil</span>
	<span class="p">}</span>

	<span class="n">klog</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="m">4</span><span class="p">)</span><span class="o">.</span><span class="n">Infof</span><span class="p">(</span><span class="s">"Defaulting class for Ingress %s to %s"</span><span class="p">,</span> <span class="n">ingress</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">defaultClass</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
	<span class="n">ingress</span><span class="o">.</span><span class="n">Spec</span><span class="o">.</span><span class="n">IngressClassName</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">defaultClass</span><span class="o">.</span><span class="n">Name</span>
	<span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>
</code></pre></div></div> <p>å¯ä»¥çœ‹åˆ°ï¼Œæåˆ°äº†é»˜è®¤çš„IngressClassçš„è¯ï¼Œå°±æŠŠIngressé…ç½®é‡Œçš„<code class="language-plaintext highlighter-rouge">Spec.IngressClassName</code>è®¾ç½®ä¸ºé»˜è®¤çš„IngressClassåç§°</p> <p>ç„¶åæˆ‘ä»¬åˆ°ingress-nginxçœ‹çœ‹ï¼Œå…¥å£æ˜¯<code class="language-plaintext highlighter-rouge">cmd/nginx</code> ï¼Œmainé‡Œä¸»è¦åšäº†ä»¥ä¸‹è¿™äº›æ“ä½œï¼š</p> <ol> <li>åˆå§‹åŒ–å¹¶å’Œkube-apiserverå»ºç«‹è¿æ¥</li> <li>åšä¸€äº›ç‰ˆæœ¬æ ¡éªŒã€æƒé™æ£€æŸ¥</li> <li>åˆå§‹åŒ–è‡ªç›‘æ§ï¼ˆprometheusï¼‰é‡‡é›†å™¨</li> <li>åˆå§‹åŒ–nginxæ§åˆ¶å™¨controllerï¼Œé‡ç‚¹æ˜¯è¿™éƒ¨åˆ†</li> <li>å¯åŠ¨HTTPæœåŠ¡ï¼Œè‡ªç›‘æ§å’Œå¥åº·æ£€æŸ¥</li> <li>å¯åŠ¨nginxæ§åˆ¶å™¨</li> </ol> <p>nginx controllerä¸»è¦åšäº†ä»¥ä¸‹çš„æ“ä½œï¼š</p> <ol> <li>åˆå§‹åŒ–å¹¶å¯åŠ¨åŒæ­¥ç¼“å­˜æ¨¡å—ï¼ˆstoreï¼‰</li> <li>åˆå§‹åŒ–å†…å­˜é˜Ÿåˆ—ç”¨æ¥å¤„ç†é…ç½®å˜æ›´</li> <li>ç›‘å¬æœ¬åœ°æ–‡ä»¶å˜åŒ–ï¼Œnginxé…ç½®å’Œgeoipæ–‡ä»¶</li> <li>ç¡®è®¤æ˜¯å¦éœ€è¦é€‰ä¸¾ä¸»</li> <li>æ‹‰èµ·nginxï¼ˆå•ç‹¬è¿›ç¨‹ç»„ï¼‰</li> </ol> <p>è¿™é‡Œçš„storeä¼šé€šè¿‡å¤šä¸ªinfomerå’Œlisterï¼ˆk8s.io/client-goï¼‰å»å’Œkube-apiserveråŒæ­¥ä¿¡æ¯å¹¶åœ¨æœ¬åœ°åšä¸€ä¸ªç¼“å­˜ï¼Œæ¯”å¦‚æ„ŸçŸ¥åˆ°å¯¹åº”çš„ingerssåº”ç”¨çš„é…ç½®æ›´æ–°å°±å¯ä»¥å»åˆ·å¯¹åº”çš„nginxé…ç½®å¹¶é‡æ–°åŠ è½½</p> <p>åœ¨<code class="language-plaintext highlighter-rouge">internal/ingress/controller/store/store.go:429</code> å¯ä»¥çœ‹åˆ°</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		<span class="n">AddFunc</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">obj</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
			<span class="n">ing</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">toIngress</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

			<span class="k">if</span> <span class="o">!</span><span class="n">watchedNamespace</span><span class="p">(</span><span class="n">ing</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span>
			<span class="p">}</span>

			<span class="n">ic</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">store</span><span class="o">.</span><span class="n">GetIngressClass</span><span class="p">(</span><span class="n">ing</span><span class="p">,</span> <span class="n">icConfig</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
				<span class="n">klog</span><span class="o">.</span><span class="n">InfoS</span><span class="p">(</span><span class="s">"Ignoring ingress because of error while validating ingress class"</span><span class="p">,</span> <span class="s">"ingress"</span><span class="p">,</span> <span class="n">klog</span><span class="o">.</span><span class="n">KObj</span><span class="p">(</span><span class="n">ing</span><span class="p">),</span> <span class="s">"error"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
				<span class="k">return</span>
			<span class="p">}</span>

			<span class="n">klog</span><span class="o">.</span><span class="n">InfoS</span><span class="p">(</span><span class="s">"Found valid IngressClass"</span><span class="p">,</span> <span class="s">"ingress"</span><span class="p">,</span> <span class="n">klog</span><span class="o">.</span><span class="n">KObj</span><span class="p">(</span><span class="n">ing</span><span class="p">),</span> <span class="s">"ingressclass"</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>

			<span class="k">if</span> <span class="n">deepInspector</span> <span class="p">{</span>
				<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">inspector</span><span class="o">.</span><span class="n">DeepInspect</span><span class="p">(</span><span class="n">ing</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
					<span class="n">klog</span><span class="o">.</span><span class="n">ErrorS</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="s">"received invalid ingress"</span><span class="p">,</span> <span class="s">"ingress"</span><span class="p">,</span> <span class="n">klog</span><span class="o">.</span><span class="n">KObj</span><span class="p">(</span><span class="n">ing</span><span class="p">))</span>
					<span class="k">return</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="n">hasCatchAllIngressRule</span><span class="p">(</span><span class="n">ing</span><span class="o">.</span><span class="n">Spec</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">disableCatchAll</span> <span class="p">{</span>
				<span class="n">klog</span><span class="o">.</span><span class="n">InfoS</span><span class="p">(</span><span class="s">"Ignoring add for catch-all ingress because of --disable-catch-all"</span><span class="p">,</span> <span class="s">"ingress"</span><span class="p">,</span> <span class="n">klog</span><span class="o">.</span><span class="n">KObj</span><span class="p">(</span><span class="n">ing</span><span class="p">))</span>
				<span class="k">return</span>
			<span class="p">}</span>

			<span class="n">recorder</span><span class="o">.</span><span class="n">Eventf</span><span class="p">(</span><span class="n">ing</span><span class="p">,</span> <span class="n">corev1</span><span class="o">.</span><span class="n">EventTypeNormal</span><span class="p">,</span> <span class="s">"Sync"</span><span class="p">,</span> <span class="s">"Scheduled for sync"</span><span class="p">)</span>

			<span class="n">store</span><span class="o">.</span><span class="n">syncIngress</span><span class="p">(</span><span class="n">ing</span><span class="p">)</span>
			<span class="n">store</span><span class="o">.</span><span class="n">updateSecretIngressMap</span><span class="p">(</span><span class="n">ing</span><span class="p">)</span>
			<span class="n">store</span><span class="o">.</span><span class="n">syncSecrets</span><span class="p">(</span><span class="n">ing</span><span class="p">)</span>

			<span class="n">updateCh</span><span class="o">.</span><span class="n">In</span><span class="p">()</span> <span class="o">&lt;-</span> <span class="n">Event</span><span class="p">{</span>
				<span class="n">Type</span><span class="o">:</span> <span class="n">CreateEvent</span><span class="p">,</span>
				<span class="n">Obj</span><span class="o">:</span>  <span class="n">obj</span><span class="p">,</span>
			<span class="p">}</span>
		<span class="p">},</span>
</code></pre></div></div> <p>è¿™éƒ¨åˆ†ä»£ç æ˜¯åœ¨Ingressèµ„æºå¢åŠ çš„æ—¶å€™ä¼šå›è°ƒçš„å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ic</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">store</span><span class="o">.</span><span class="n">GetIngressClass</span><span class="p">(</span><span class="n">ing</span><span class="p">,</span> <span class="n">icConfig</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
	<span class="n">klog</span><span class="o">.</span><span class="n">InfoS</span><span class="p">(</span><span class="s">"Ignoring ingress because of error while validating ingress class"</span><span class="p">,</span> <span class="s">"ingress"</span><span class="p">,</span> <span class="n">klog</span><span class="o">.</span><span class="n">KObj</span><span class="p">(</span><span class="n">ing</span><span class="p">),</span> <span class="s">"error"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="k">return</span>
<span class="p">}</span>
</code></pre></div></div> <p>è¿™é‡Œè°ƒç”¨äº†<code class="language-plaintext highlighter-rouge">store.GetIngressClass</code>éªŒè¯å¯¹åº”çš„IngressClasså’Œè‡ªèº«æ˜¯å¦ç¬¦åˆ</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">k8sStore</span><span class="p">)</span> <span class="n">GetIngressClass</span><span class="p">(</span><span class="n">ing</span> <span class="o">*</span><span class="n">networkingv1</span><span class="o">.</span><span class="n">Ingress</span><span class="p">,</span> <span class="n">icConfig</span> <span class="o">*</span><span class="n">ingressclass</span><span class="o">.</span><span class="n">Configuration</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="c">// First we try ingressClassName</span>
	<span class="k">if</span> <span class="o">!</span><span class="n">icConfig</span><span class="o">.</span><span class="n">IgnoreIngressClass</span> <span class="o">&amp;&amp;</span> <span class="n">ing</span><span class="o">.</span><span class="n">Spec</span><span class="o">.</span><span class="n">IngressClassName</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">iclass</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">s</span><span class="o">.</span><span class="n">listers</span><span class="o">.</span><span class="n">IngressClass</span><span class="o">.</span><span class="n">ByKey</span><span class="p">(</span><span class="o">*</span><span class="n">ing</span><span class="o">.</span><span class="n">Spec</span><span class="o">.</span><span class="n">IngressClassName</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="s">""</span><span class="p">,</span> <span class="n">err</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">iclass</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="no">nil</span>
	<span class="p">}</span>

	<span class="c">// Then we try annotation</span>
	<span class="k">if</span> <span class="n">class</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">ing</span><span class="o">.</span><span class="n">GetAnnotations</span><span class="p">()[</span><span class="n">ingressclass</span><span class="o">.</span><span class="n">IngressKey</span><span class="p">];</span> <span class="n">ok</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">class</span> <span class="o">!=</span> <span class="n">icConfig</span><span class="o">.</span><span class="n">AnnotationValue</span> <span class="p">{</span>
			<span class="k">return</span> <span class="s">""</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"ingress class annotation is not equal to the expected by Ingress Controller"</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">class</span><span class="p">,</span> <span class="no">nil</span>
	<span class="p">}</span>

	<span class="c">// Then we accept if the WithoutClass is enabled</span>
	<span class="k">if</span> <span class="n">icConfig</span><span class="o">.</span><span class="n">WatchWithoutClass</span> <span class="p">{</span>
		<span class="c">// Reserving "_" as a "wildcard" name</span>
		<span class="k">return</span> <span class="s">"_"</span><span class="p">,</span> <span class="no">nil</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="s">""</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"ingress does not contain a valid IngressClass"</span><span class="p">)</span>
<span class="p">}</span>
<span class="c">// ...</span>
<span class="k">const</span> <span class="p">(</span>
	<span class="c">// IngressKey picks a specific "class" for the Ingress.</span>
	<span class="c">// The controller only processes Ingresses with this annotation either</span>
	<span class="c">// unset, or set to either the configured value or the empty string.</span>
	<span class="n">IngressKey</span> <span class="o">=</span> <span class="s">"kubernetes.io/ingress.class"</span>

	<span class="c">// DefaultControllerName defines the default controller name for Ingress NGINX</span>
	<span class="n">DefaultControllerName</span> <span class="o">=</span> <span class="s">"k8s.io/ingress-nginx"</span>

	<span class="c">// DefaultAnnotationValue defines the default annotation value for the ingress-nginx controller</span>
	<span class="n">DefaultAnnotationValue</span> <span class="o">=</span> <span class="s">"nginx"</span>
<span class="p">)</span>
</code></pre></div></div> <p>è¿™è¾¹å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®è¿™æ ·çš„é¡ºåºè·å–IngressClass Nameï¼š</p> <ol> <li>å…ˆä»spec.ingressClassNameè·å–</li> <li>å†ä»annotationsçš„kubernetes.io/ingress.classè·å–</li> </ol> <p>æ‰€åœ¨åœ¨éƒ½æ²¡æœ‰æŒ‡å®šçš„æƒ…å†µä¸‹ï¼Œå°±åŒ¹é…ä¸åˆ°ï¼Œå°±ä¸ä¼šå¤„ç†è¿™ä¸ªIngressèµ„æºå¯¹è±¡äº†ï¼Œè¿™é‡ŒIngressClassNameæ˜¯1.18å¼•å…¥çš„ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªï¼Œç„¶åannotationsæ˜¯ä¸ºäº†å…¼å®¹æ—§çš„ï¼Œæ‰€ä»¥ç†è®ºä¸Šå¦‚æœk8sæ˜¯1.18ä¹‹åçš„ç‰ˆæœ¬ï¼Œè¿˜æ˜¯åº”è¯¥é‡‡ç”¨IngressClassNameã€‚</p> <p>ç»“åˆå‰é¢kube-apiserverçš„ä»£ç ï¼Œä»¥åŠtraefikæ˜¯é»˜è®¤çš„IngressClassï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å…¶å®è¿™è¾¹spec.ingressClassNameä¼šè¢«å¡«å……ä¸ºtraefikï¼Œæˆ‘ä»¬çœ‹ä¸‹ingres-nginxå®¹å™¨çš„æ—¥å¿—</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">I1204</span> <span class="m">09</span><span class="o">:</span><span class="m">51</span><span class="o">:</span><span class="m">54.338921</span>       <span class="m">7</span> <span class="n">store</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">436</span><span class="p">]</span> <span class="s">"Ignoring ingress because of error while validating ingress class"</span> <span class="n">ingress</span><span class="o">=</span><span class="s">"default/nginx-ingress"</span> <span class="kt">error</span><span class="o">=</span><span class="s">"no object matching key </span><span class="se">\"</span><span class="s">traefik</span><span class="se">\"</span><span class="s"> in local store"</span>
</code></pre></div></div> <p>å¯ä»¥çœ‹åˆ°ï¼ŒåŒ¹é…åˆ°traefikï¼Œç¬¦åˆé¢„æœŸã€‚</p> <p>å½“æˆ‘ä»¬æ²¡æœ‰traefikçš„æƒ…å†µä¸‹ï¼Œåˆæ²¡æœ‰é…ç½®é»˜è®¤çš„IngressClassï¼Œåœ¨Ingressæäº¤çš„æ—¶å€™åˆæ²¡æœ‰æŒ‡å®šspec.ingressClassNameå’Œannotationsçš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ˜¯æ— æ³•å‘½ä¸­</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-12-19-default-ingress-class/no-default-ingress-class-480.webp 480w,/assets/img/2024-12-19-default-ingress-class/no-default-ingress-class-800.webp 800w,/assets/img/2024-12-19-default-ingress-class/no-default-ingress-class-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-12-19-default-ingress-class/no-default-ingress-class.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> æ— é»˜è®¤IngressClass </div> <p><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource">å®˜æ–¹æ–‡æ¡£</a>ä¹Ÿæœ‰è¯´æ˜è¿™ä¸ªï¼Œk8sæœ¬èº«æ˜¯ä¸ä¼šæŒ‡å®šé»˜è®¤çš„IngressClassï¼Œä¹Ÿå¯ä»¥ç†è§£ï¼Œk8sæœ¬èº«å¹¶æ²¡æœ‰å†…ç½®IngressClassã€‚</p> <p>ingress-nginxå¯ä»¥è¿™æ ·é…ç½®æˆé»˜è®¤çš„IngressClass</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">IngressClass</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-example</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">ingressclass.kubernetes.io/is-default-class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">controller</span><span class="pi">:</span> <span class="s">k8s.io/ingress-nginx</span>
</code></pre></div></div>]]></content><author><name></name></author><category term="Kubernetes"/><category term="Kubernetes"/><summary type="html"><![CDATA[æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯Ingressé…ç½®é”™è¯¯é—®é¢˜å¯¼è‡´äº†åˆ°Ingressçš„æµé‡å§‹ç»ˆæ— æ³•æµåˆ°å¯¹åº”çš„Service]]></summary></entry><entry><title type="html">15sâ†’1sæ…¢æŸ¥è¯¢ä¼˜åŒ–å°è®°</title><link href="https://ifuryst.github.io/blog/2024/optimizing-slow-queries-from-15s-to-1s/" rel="alternate" type="text/html" title="15sâ†’1sæ…¢æŸ¥è¯¢ä¼˜åŒ–å°è®°"/><published>2024-11-22T13:41:27+00:00</published><updated>2024-11-22T13:41:27+00:00</updated><id>https://ifuryst.github.io/blog/2024/optimizing-slow-queries-from-15s-to-1s</id><content type="html" xml:base="https://ifuryst.github.io/blog/2024/optimizing-slow-queries-from-15s-to-1s/"><![CDATA[<p>SQLæ…¢æŸ¥è¯¢æ˜¯è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ï¼Œä¼¼ä¹å¥½åƒä¸ä¼šåšç‚¹ä¼˜åŒ–éƒ½ä¸è¡Œã€‚æ…¢æŸ¥è¯¢ä¼˜åŒ–å…¶å®æœ‰å¾ˆå¤šæ‰‹æ®µï¼Œå¹¶ä¸”ä¹Ÿæ ¹æ®åº”ç”¨åœºæ™¯å’Œéœ€æ±‚è€Œå¼‚ï¼Œæˆ‘è§‰å¾—æ¯”è¾ƒé‡è¦çš„è¿˜æ˜¯äº†è§£åº•å±‚åŸç†ï¼Œè¿™æ ·ä¸Šå±‚åº”ç”¨å±‚æ€ä¹ˆå˜åŒ–éƒ½èƒ½æ¯”è¾ƒå¿«çš„æ‰¾åˆ°ä¼˜åŒ–çš„ç‚¹ã€‚å€Ÿç€è¿™ä¸ªæœºä¼šå°è°ˆä¸€ä¸‹SQLä¼˜åŒ–ä¸­çš„ä¸€äº›è¿‡ç¨‹å’Œæƒ³æ³•ã€‚</p> <p>å¦å¤–æœ‰ç‚¹æ ‡é¢˜å…šäº†ï¼Œæˆ‘è§‰å¾—èƒ½æœ‰è¾ƒå¤§æ”¶ç›Šçš„æƒ…å†µå¾ˆæœ‰å¯èƒ½æ˜¯å› ä¸ºåº•å­å¤ªå·®äº†ï¼Œå°±åƒè¿™æ¬¡å¸®äººçœ‹çš„è¿™ä¸ªé¡¹ç›®ï¼Œæ‰èƒ½ç®€å•çš„åšå‡ºè¿™ä¹ˆå¤§çš„ä¼˜åŒ–ã€‚ä¸è¿‡ä¸–ç•Œæ˜¯ä¸ªè‰å°ç­å­ï¼Œåˆ°å“ªéƒ½å¯èƒ½é‡åˆ°å› è‚éœ€æ±‚è€Œç•™ä¸‹çš„æŠ€æœ¯å€ºï¼Œè¿™ç§åœ°æ–¹å¦‚æœæ²¡æœ‰åšå¥½é¡¶å±‚è®¾è®¡å’Œä»£ç è´¨é‡æŠŠæ§çš„è¯ï¼Œæå…¶å®¹æ˜“å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå †éœ€æ±‚ï¼Œç„¶åå‡ºé—®é¢˜å†æ¥åå‘ä¼˜åŒ–è§£å†³çš„æƒ…å†µã€‚</p> <h2 id="å‡†å¤‡é˜¶æ®µ">å‡†å¤‡é˜¶æ®µ</h2> <p>å¼€å§‹å¤„ç†æ…¢æŸ¥è¯¢é—®é¢˜å‰ï¼Œæœ‰å‡ ä¸ªä¸œè¥¿éœ€è¦æå‰å‡†å¤‡å¥½ï¼š</p> <ol> <li>å…·ä½“äº§ç”Ÿä½ç½®</li> <li>æ•°æ®ç»„è£…</li> <li>å®šåŸºå‡†ç‚¹</li> </ol> <h3 id="å…·ä½“äº§ç”Ÿä½ç½®">å…·ä½“äº§ç”Ÿä½ç½®</h3> <p>è¿™é‡Œä¸»è¦æ˜¯å®šä½é—®é¢˜äº§ç”Ÿç‚¹ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬æœ‰æ…¢æŸ¥è¯¢çš„ç»Ÿè®¡SQLï¼Œå°±èƒ½è¿›ä¸€æ­¥æ ¹æ®è¯­å¥åˆ°ä»£ç åå·®ï¼Œè¿™éƒ¨åˆ†é€šå¸¸æ¯”è¾ƒå®¹æ˜“çš„å°±å¯ä»¥åšå¥½å®šä½ã€‚</p> <p>é€šå¸¸æˆ‘ä»¬ä¼šåŸºäºäº§ç”Ÿä½ç½®åå‘æ‘¸æ’ï¼Œç¡®å®šè°ƒç”¨æ–¹ï¼Œè¿™æ ·å¯ä»¥è¿›ä¸€æ­¥ç¡®å®šå½±å“èŒƒå›´ï¼Œå‡å°‘åç»­æ”¹åŠ¨å¯¹å¤–éƒ¨çš„å½±å“</p> <h3 id="æ•°æ®ç»„è£…">æ•°æ®ç»„è£…</h3> <p>éœ€è¦è¿›è¡Œå„ç±»æ•°æ®æˆ–è€…å‚æ•°çš„ç»„è£…ï¼Œç”¨äºå¤ç°å®é™…é—®é¢˜ã€‚</p> <p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æœ€å¤§åŒ–è´Ÿè½½ï¼Œä¹Ÿå°±æ˜¯ä»¥ä¸šåŠ¡èŒƒå›´å†…è¾ƒç³Ÿç³•çš„æƒ…å†µæ¥ç»„è£…æ•°æ®è¿›è¡Œå¤ç°ï¼Œèƒ½æœ‰å‹æµ‹æ¡ä»¶æ˜¯æ›´å¥½çš„ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æœ€å¤§åŒ–å„ä¸ªå…³é”®ç¯èŠ‚å’ŒèŠ‚ç‚¹çš„æ¶ˆè€—æƒ…å†µï¼Œå¯ä»¥è¿›ä¸€æ­¥ç ”åˆ¤ä¼˜åŒ–ä½ç½®</p> <h3 id="å®šåŸºå‡†ç‚¹">å®šåŸºå‡†ç‚¹</h3> <p>æˆ‘ä»¬é€šå¸¸ä¼šä»¥å‰é¢ç¡®å®šçš„è¾ƒåçš„æƒ…å†µåšåŸºå‡†ï¼Œåç»­ä»¥æ­¤ä¸ºåŸºå‡†å»åšä¼˜åŒ–ï¼Œè¿™æ ·èƒ½ç»™æˆ‘ä»¬ä¼˜åŒ–æä¾›æ–¹å‘å’Œç»“æœçš„é‡åŒ–ã€‚å¦å¤–æœ‰äº›æƒ…å†µä¸‹æˆ‘ä»¬è¿˜ä¼šæœ‰æ˜ç¡®çš„ç›®æ ‡é˜ˆå€¼æŒ‡å¯¼æˆ‘ä»¬æŒç»­ä¼˜åŒ–åˆ°ç›®æ ‡</p> <h2 id="ä¼˜åŒ–è¿‡ç¨‹">ä¼˜åŒ–è¿‡ç¨‹</h2> <p>å¯¹äºæ…¢æŸ¥è¯¢çš„ä¼˜åŒ–æœ‰éå¸¸å¤šçš„æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦æ²¿ç€æ­¤æ¬¡é‡åˆ°çš„é—®é¢˜æå–å…³é”®ä¼˜åŒ–ç‚¹åšä¸€å®šçš„åˆ†æå’Œå‘æ•£ã€‚</p> <p>å› ä¸ºé—®é¢˜æ¯”è¾ƒæ˜ç¡®ï¼Œè¿™è¾¹æˆ‘ä»¬åœ¨ç»„è£…å®Œæ‰€éœ€çš„é…å¥—æ•°æ®å’Œå‚æ•°ä¹‹åï¼Œå°±ç›´æ¥åˆ°å…³é”®çš„SQLéƒ¨åˆ†å»åšåˆ†é˜¶æ®µçš„æ‰“å°ï¼Œå› ä¸ºæ¶‰åŠçš„SQLæ“ä½œæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›èƒ½æ˜ç¡®å„é˜¶æ®µçš„æ¶ˆè€—ã€‚è¿™è¾¹æˆ‘åœ¨ä»£ç é‡Œä¸€äº›å…³é”®ç‚¹åŸ‹äº†ä¸€ä¸‹æ‰“å°ã€‚è·‘æµ‹åï¼Œæˆ‘ä»¬å¾—åˆ°åˆ†é˜¶æ®µçš„æ¶ˆè€—ç»Ÿè®¡</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Stage 1: <span class="o">===&gt;</span> 428ms
Stage 2: <span class="o">===&gt;</span> 138ms
Stage 3: <span class="o">===&gt;</span> 7ms
Stage 4: <span class="o">===&gt;</span> 617ms
Stage 5: <span class="o">===&gt;</span> 13898ms
</code></pre></div></div> <p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ˜ç¡®é—®é¢˜å‡ºç°é˜¶æ®µ5ï¼Œæ¶ˆè€—äº†13sçš„æŸ¥è¯¢æ—¶é—´ï¼Œæˆ‘ä»¬å…ˆç€é‡å¤„ç†è¿™ä¸ªä½ç½®</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_code.2024-11-22_15-51-28-480.webp 480w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_code.2024-11-22_15-51-28-800.webp 800w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_code.2024-11-22_15-51-28-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_code.2024-11-22_15-51-28.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> åŸå§‹ä»£ç  </div> <p>é¦–å…ˆè§‚å¯Ÿåˆ°æœ‰3ä¸ªæ•°æ®åº“æŸ¥è¯¢çš„è°ƒç”¨ï¼Œåä¸¤ä¸ªè¿˜å¥½ç‚¹ï¼Œé€šè¿‡INçš„æ–¹å¼èµ°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¤§é‡LIKEçš„æ–¹å¼ï¼Œæˆ‘ä»¬ä¼˜å…ˆè§£å†³è¿™ä¸ªï¼Œè¿™é‡Œå°±äº§ç”Ÿäº†ç¬¬ä¸€ä¸ªä¼˜åŒ–ç‚¹ï¼šLIKEçš„ä½¿ç”¨</p> <h3 id="likeçš„ä½¿ç”¨">LIKEçš„ä½¿ç”¨</h3> <p>é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå°½é‡ä¸ä½¿ç”¨æˆ–è€…å‡å°‘ä½¿ç”¨LIKEå­å¥ï¼ŒMySQLä¸­LIKEåªæœ‰åœ¨å‰ç¼€åŒ¹é…çš„æ—¶å€™æ‰ä¼šèµ°ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ç²¾å‡†åŒ¹é…æˆ–è€…å­—ç¬¦ä¸²å¼€å¤´çš„ï¼Œå¯ä»¥èµ°ç´¢å¼•</span>
SELECT <span class="k">*</span> FROM table WHERE column LIKE <span class="s1">'abc%'</span><span class="p">;</span>
SELECT <span class="k">*</span> FROM table WHERE column LIKE <span class="s1">'abc'</span><span class="p">;</span>
<span class="c"># é€šé…ç¬¦å¼€å¤´çš„ï¼Œä¸èµ°ç´¢å¼•</span>
SELECT <span class="k">*</span> FROM table WHERE column LIKE <span class="s1">'%abc'</span><span class="p">;</span>
SELECT <span class="k">*</span> FROM table WHERE column LIKE <span class="s1">'%abc%'</span><span class="p">;</span>
</code></pre></div></div> <p>å¯¹äºå¤§æ•°æ®é›†æ¥è¯´ï¼Œè¿™ç§æ¨¡ç³ŠåŒ¹é…æ€§èƒ½å¾ˆä½ï¼Œå°½å¯èƒ½åº”è¯¥é¿å…ï¼Œæˆ–è€…é‡‡ç”¨ESä¹‹ç±»çš„ä¸“ç”¨å…¨æ–‡æœç´¢å¼•æ“ã€‚</p> <p>é€šè¿‡å¯¹å¤–éƒ¨æ‰€æœ‰è°ƒç”¨æ–¹çš„å…¥å‚æƒ…å†µç¡®è®¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºè¿™é‡Œå¹¶ä¸éœ€è¦ä½¿ç”¨LIKEï¼Œå› ä¸ºä¼ å…¥çš„orgIdListå…¶å®å·²ç»åŒ…å«äº†çˆ¶å­orgIdçš„å®Œæ•´åˆé›†äº†ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥å»æ‰LIKEéƒ¨åˆ†çš„æ£€ç´¢</p> <p>æˆ‘ä»¬è·‘æµ‹ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»ä»13så°†ä¸º3säº†</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Stage 1: <span class="o">===&gt;</span> 279ms
Stage 2: <span class="o">===&gt;</span> 160ms
Stage 3: <span class="o">===&gt;</span> 2ms
Stage 4: <span class="o">===&gt;</span> 601ms
Stage 5: <span class="o">===&gt;</span> 3202ms
</code></pre></div></div> <p>æ­¤æ—¶æˆ‘ä»¬è¿›ä¸€æ­¥æ¥çœ‹çœ‹å‰©ä¸‹çš„ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°å–å‡ºæ¥çš„æ•°æ®åªæ˜¯æœŸæœ›å¾—åˆ°å…¶ä¸­æŸä¸€åˆ—çš„æ•°æ®ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å°±æ¥åˆ°äº†ç¬¬äºŒä¸ªä¼˜åŒ–ç‚¹ï¼šåªæŸ¥è¯¢å¿…è¦çš„åˆ—</p> <h3 id="åªæŸ¥è¯¢å¿…è¦çš„åˆ—">åªæŸ¥è¯¢å¿…è¦çš„åˆ—</h3> <p>å°¤å…¶å¯¹äºä¸€äº›æ•°æ®é‡å¤§ï¼Œæˆ–è€…åˆ—å¤šçš„å¤§å®½è¡¨æ¥è¯´ï¼Œå¦‚æœèƒ½æ˜¾å¼æŒ‡å®šåˆ—çš„è¯ï¼Œå¯ä»¥æå‡æŸ¥è¯¢å’Œæ•°æ®è¿”å›è¿‡ç¨‹ä¸­çš„æ¶ˆè€—ï¼Œè¿™è¾¹æˆ‘ä»¬æ”¶æ•›ä¸€ä¸‹ï¼Œå¹¶ä¸”æŠŠä»£ç ç»“æ„ç®€å•è°ƒæ•´ä¸€ä¸‹ä½¿å¾—ä»£ç æ›´åŠ ç›´è§‚</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/specify_cols.2024-11-22_15-57-36-480.webp 480w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/specify_cols.2024-11-22_15-57-36-800.webp 800w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/specify_cols.2024-11-22_15-57-36-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/specify_cols.2024-11-22_15-57-36.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> æŒ‡å®šåˆ—æŸ¥è¯¢ </div> <p>è¿™è¾¹æˆ‘ä»¬æ˜¾å¼æŒ‡å®šäº†<code class="language-plaintext highlighter-rouge">.select(XXXRel::getOrgPersonId)</code> å’Œ<code class="language-plaintext highlighter-rouge">.select(XXXUser::getAccountId)</code> ï¼Œè¿™æ ·SELECTè¯­å¥åªä¼šæŸ¥è¯¢è¯¥åˆ—</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Stage 1: <span class="o">===&gt;</span> 260ms
Stage 2: <span class="o">===&gt;</span> 140ms
Stage 3: <span class="o">===&gt;</span> 2ms
Stage 4: <span class="o">===&gt;</span> 614ms
Stage 5: <span class="o">===&gt;</span> 1635ms
</code></pre></div></div> <p>è·‘æµ‹åå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç¯èŠ‚å·²ç»è¢«ä¼˜åŒ–åˆ°1.6säº†</p> <p>æ­¤æ—¶ä»ä»£ç å±‚é¢æˆ‘ä»¬å·²ç»çœ‹ä¸å‡ºå¤ªå¤šçš„ä¼˜åŒ–ç‚¹äº†ï¼Œä½†æ˜¯æ­¤æ—¶æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥æ·±æŒ–ä¸€ä¸‹å…·ä½“çš„SQLï¼Œå› ä¸ºä»¥æˆ‘ä»¬çš„ç»éªŒæ¥è¯´ï¼Œä¸¤ä¸ªSELECT â€¦ INæŸ¥è¯¢ä¸è‡³äºéœ€è¦1.6sï¼Œå†µä¸”æ•°æ®é›†ä¹Ÿæ²¡æœ‰è¾¾åˆ°å¤§å‡ ç™¾ä¸‡æˆ–è€…åƒä¸‡çº§åˆ«ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ç†ç”±çŒœæµ‹å¯èƒ½åœ¨SQLå±‚é¢è¿˜å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥æŒ–ä¸€ä¸‹</p> <h3 id="sqlåˆ†æ">SQLåˆ†æ</h3> <p>è¿™è¾¹æˆ‘ä»¬æ‹‰å‡ºä¸¤æ¡è¯­å¥</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">org_person_id</span> <span class="k">FROM</span> <span class="n">db_a</span><span class="p">.</span><span class="n">xxx_rel</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">status_cd</span> <span class="o">=</span> <span class="s1">'1'</span> <span class="k">AND</span> <span class="n">org_id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="p">...,</span> <span class="mi">11</span><span class="p">))</span>

<span class="k">SELECT</span> <span class="n">account_id</span> <span class="k">FROM</span> <span class="n">db_b</span><span class="p">.</span><span class="n">xxx_user</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">status_cd</span> <span class="o">=</span> <span class="s1">'1'</span> <span class="k">AND</span> <span class="n">tenant_id</span> <span class="o">=</span> <span class="s1">'abc123'</span> <span class="k">AND</span> <span class="n">org_user_id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="p">...,</span> <span class="mi">9</span><span class="p">))</span>
</code></pre></div></div> <p>è¿™é‡Œå†…å®¹è¿‡é•¿ï¼Œæˆ‘è£å‰ªäº†å¤§éƒ¨åˆ†çš„IDï¼Œä¸»è¦ç»“æ„å°±æ˜¯è¿™æ ·ï¼ŒINäº†å¤§é‡çš„IDï¼Œæˆ‘ä»¬ç”¨<code class="language-plaintext highlighter-rouge">EXPLAIN</code>æ¥åˆ†æä¸€ä¸‹è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼ˆExecution Planï¼‰ï¼Œè™½ç„¶ä¸æ˜¯å®é™…çš„æ‰§è¡Œï¼Œä½†æ˜¯é€šè¿‡é¢„æµ‹æ‰§è¡Œè®¡åˆ’çš„åˆ†æï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£æŸ¥è¯¢æ€§èƒ½å¹¶å‘ç°ä¼˜åŒ–ç‚¹</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">EXPLAIN</span> <span class="k">SELECT</span> <span class="n">org_person_id</span> <span class="k">FROM</span> <span class="n">db_a</span><span class="p">.</span><span class="n">xxx_rel</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">status_cd</span> <span class="o">=</span> <span class="s1">'1'</span> <span class="k">AND</span> <span class="n">org_id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="p">...,</span> <span class="mi">11</span><span class="p">))</span>

<span class="k">EXPLAIN</span> <span class="k">SELECT</span> <span class="n">account_id</span> <span class="k">FROM</span> <span class="n">db_b</span><span class="p">.</span><span class="n">xxx_user</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">status_cd</span> <span class="o">=</span> <span class="s1">'1'</span> <span class="k">AND</span> <span class="n">tenant_id</span> <span class="o">=</span> <span class="s1">'abc123'</span> <span class="k">AND</span> <span class="n">org_user_id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="p">...,</span> <span class="mi">9</span><span class="p">))</span>
</code></pre></div></div> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_ref_query.2024-11-19_20-03-55-480.webp 480w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_ref_query.2024-11-19_20-03-55-800.webp 800w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_ref_query.2024-11-19_20-03-55-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_ref_query.2024-11-19_20-03-55.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_all_query.2024-11-19_20-04-14-480.webp 480w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_all_query.2024-11-19_20-04-14-800.webp 800w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_all_query.2024-11-19_20-04-14-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/origin_all_query.2024-11-19_20-04-14.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> åŸå§‹æŸ¥è¯¢èµ°ç´¢å¼•æƒ…å†µ </div> <p>å¯¹åº”çš„åˆ—å¯ä»¥å‚è€ƒå®˜æ–¹çš„<a href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html">æ–‡æ¡£é‡Šä¹‰</a>ï¼š</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/explain_output_cols.2024-11-19_20-03-06-480.webp 480w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/explain_output_cols.2024-11-19_20-03-06-800.webp 800w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/explain_output_cols.2024-11-19_20-03-06-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/explain_output_cols.2024-11-19_20-03-06.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> EXPLAINåˆ—å«ä¹‰ </div> <p>è¿™è¾¹æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹typeè¿™åˆ—ï¼Œè¿™è¾¹åˆ—å‡ºä¸»è¦çš„ç±»å‹ï¼Œå®Œæ•´çš„å¯ä»¥å‚è€ƒ<a href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html#explain-join-types">å®˜æ–¹æ–‡æ¡£</a>ï¼š</p> <ul> <li>ALLï¼ˆå…¨è¡¨æ‰«æï¼‰ï¼šå¯¹æ‰€æœ‰è¡Œæ‰«æï¼Œæ•ˆç‡æœ€ä½ä¸‹</li> <li>indexï¼ˆç´¢å¼•æ‰«æï¼‰ï¼Œèµ°ç´¢å¼•å¹¶ä¸”ä¸å›è¡¨</li> <li>rangeï¼ˆç´¢å¼•èŒƒå›´æ‰«æï¼‰ï¼Œèµ°ç´¢å¼•æ‰«æä¸€éƒ¨åˆ†æ•°æ®ï¼ˆèŒƒå›´æ•°æ®ï¼‰</li> <li>refï¼ˆç´¢å¼•å¼•ç”¨ï¼‰ï¼Œèµ°éå”¯ä¸€ç´¢å¼•ï¼ˆæˆ–å”¯ä¸€ç´¢å¼•çš„å‰ç¼€éƒ¨åˆ†ï¼‰ï¼Œé€šå¸¸éœ€è¦å›è¡¨</li> </ul> <p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªè¯­å¥typeèµ°äº†refï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•å¼•ç”¨ï¼Œè¿™è¾¹æˆ‘ä»¬å°±å…ˆä¸ç®¡äº†ï¼ˆç†è®ºä¸Šè¿™é‡Œå¯ä»¥ç”¨è”åˆç´¢å¼•å¢åŠ ç´¢å¼•çº§åˆ«ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥å…ˆä¸è€ƒè™‘åšè¿™ä¸ªä¼˜åŒ–ï¼‰</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/ref_index.2024-11-19_20-02-52-480.webp 480w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/ref_index.2024-11-19_20-02-52-800.webp 800w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/ref_index.2024-11-19_20-02-52-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/ref_index.2024-11-19_20-02-52.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> ç´¢å¼•æƒ…å†µ </div> <p>ç¬¬äºŒå¥å°±å¾ˆå¥‡æ€ªï¼Œç›´æ¥èµ°ALLå…¨è¡¨äº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ç´¢å¼•ï¼Œå‘ç°status_cdï¼Œtenant_idå’Œorg_user_idéƒ½æ²¡æœ‰ä»»ä½•ç´¢å¼•</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/all_index.2024-11-22_16-04-24-480.webp 480w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/all_index.2024-11-22_16-04-24-800.webp 800w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/all_index.2024-11-22_16-04-24-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/all_index.2024-11-22_16-04-24.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> ç´¢å¼•æƒ…å†µ </div> <p>è¿™è¾¹æˆ‘ä»¬ç›´æ¥åšä¸€ä¸ªè”åˆç´¢å¼•</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">db_b</span><span class="p">.</span><span class="n">xxx_user</span>
<span class="k">ADD</span> <span class="k">INDEX</span> <span class="n">idx_status_tenant_orguser</span> <span class="p">(</span><span class="n">tenant_id</span><span class="p">,</span> <span class="n">status_cd</span><span class="p">,</span> <span class="n">org_user_id</span><span class="p">);</span>
</code></pre></div></div> <p>è·‘æµ‹ä¸€ä¸‹çœ‹çœ‹ï¼Œå‡ºä¹æ„æ–™çš„ï¼Œç«Ÿç„¶æ²¡æœ‰å¤šå°‘æå‡</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Stage</span> <span class="mi">1</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">261</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">2</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">135</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">3</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">3</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">4</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">604</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">5</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">1599</span><span class="n">ms</span>
</code></pre></div></div> <p>æˆ‘ä»¬ä¹Ÿæ˜ç¡®çš„çœ‹åˆ°äº†è¯­å¥æ˜¯èµ°ç´¢å¼•çš„</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/add_index.2024-11-19_20-23-08-480.webp 480w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/add_index.2024-11-19_20-23-08-800.webp 800w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/add_index.2024-11-19_20-23-08-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/add_index.2024-11-19_20-23-08.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> å¢åŠ ç´¢å¼• </div> <p>ç»è¿‡åˆ†æï¼Œæ˜¯å› ä¸ºè¯¥è¡¨æœ¬èº«çš„é‡çº§ä¸å¤§ï¼Œæ‰€ä»¥èµ°ALLå’Œç´¢å¼•çš„æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æ—¶é—´å·®ä¸å¤šã€‚å¦å¤–è¿›ä¸€éƒ¨åˆ†åˆ†æäº†ä¸¤æ¡SQLçš„æ‰§è¡Œæ—¶é—´ï¼ŒåŸºæœ¬éƒ½æ˜¯åœ¨msçº§åˆ«çš„ï¼ˆåˆ†åˆ«0.12629075å’Œ0.0343075ï¼‰ï¼Œå¤§ä½“æ˜¯å‡ åmsåˆ°100ms+è¿™æ ·çš„æ°´å¹³ï¼Œå®é™…ä¸Šè¿™è¾¹çš„æ—¶é—´åˆ†åˆ«æ¶ˆè€—åœ¨ï¼š</p> <ol> <li>MySQLæŸ¥è¯¢å¼•æ“æœ¬èº«ï¼Œå•æ¡å•æ¬¡100msæ¥è®¡ç®—ï¼ŒæŒ‰ç…§æ€»300ms</li> <li>ç½‘ç»œè€—æ—¶ï¼Œæ¥å›çš„Roundtripå¤§æ¦‚éœ€è¦200msï¼ˆå…·ä½“å› é“¾è·¯æƒ…å†µè€Œå®šï¼‰ï¼Œè¿™è¾¹2æ¬¡æŒ‰ç…§400msç®—</li> <li>å…¶ä»–çš„éƒ½æ˜¯æ¶ˆè€—åœ¨ç³»ç»Ÿå±‚å’Œåº”ç”¨å±‚åšæ•°æ®æ‹†è§£åŒ…ã€å¤åˆ¶å’Œè§£æè¿™éƒ¨åˆ†çš„æ¶ˆè€—</li> </ol> <p>è¿™è¾¹æˆ‘ä»¬æ ¹æ®å®é™…è§‚æµ‹å¯ä»¥å¾—å‡ºçš„ç»“è®ºæ˜¯å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ¶ˆè€—åœ¨2ã€3é˜¶æ®µäº†ï¼Œå› æ­¤æˆ‘ä»¬è¦ç»§ç»­åšä¸€ä¸ªä¼˜åŒ–åŠ¨ä½œï¼šåˆå¹¶æ•°æ®åº“æŸ¥è¯¢æ“ä½œ</p> <h3 id="åˆå¹¶æ•°æ®åº“æŸ¥è¯¢æ“ä½œ">åˆå¹¶æ•°æ®åº“æŸ¥è¯¢æ“ä½œ</h3> <p>è¿™è¾¹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®é™…ä¸Šå‰ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœå®é™…ä¸Šæ˜¯ä¸ºäº†ç»™åä¸€æ¬¡ä½¿ç”¨ï¼Œä¸”æ²¡æœ‰ä»»ä½•å…¶ä»–ç”¨é€”äº†ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥å‡å°‘è¿™æ¬¡çš„ç½‘ç»œä¼ è¾“å’Œç›¸åº”çš„åº”ç”¨å±‚å¤„ç†çš„æ—¶é—´ï¼Œç›´æ¥äº¤ç»™æ•°æ®åº“å¼•æ“å¤„ç†ï¼Œè¿™ä¸ªåœ¨å¤§æ•°æ®é›†çš„æƒ…å†µä¸‹å°¤å…¶æœ‰æ•ˆï¼Œå¹¶ä¸”ä¹Ÿæ˜¯DBçš„ä¸€ä¸ªèƒ½åŠ›ä¹‹ä¸€ã€‚</p> <p>è¿™è¾¹æˆ‘ä»¬å¢åŠ ä¸€ä¸ªåµŒå¥—æŸ¥è¯¢ï¼Œå¤§ä½“ä¸ºï¼š</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>
    <span class="k">distinct</span> <span class="n">u</span><span class="p">.</span><span class="n">account_id</span>
<span class="k">FROM</span>
    <span class="n">db_b</span><span class="p">.</span><span class="n">xxx_user</span> <span class="n">u</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">db_a</span><span class="p">.</span><span class="n">tf_org_person_rel</span> <span class="n">r</span>
<span class="k">ON</span>
    <span class="n">u</span><span class="p">.</span><span class="n">org_user_id</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">org_person_id</span>
<span class="k">WHERE</span>
    <span class="n">r</span><span class="p">.</span><span class="n">status_cd</span> <span class="o">=</span> <span class="s1">'1'</span>
    <span class="k">AND</span> <span class="n">r</span><span class="p">.</span><span class="n">org_id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">429763</span><span class="p">,</span> <span class="mi">429764</span><span class="p">,</span> <span class="mi">2361116</span><span class="p">,</span> <span class="p">...,</span> <span class="mi">2558342</span><span class="p">)</span>
    <span class="k">AND</span> <span class="n">u</span><span class="p">.</span><span class="n">status_cd</span> <span class="o">=</span> <span class="s1">'1'</span>
    <span class="k">AND</span> <span class="n">u</span><span class="p">.</span><span class="n">tenant_id</span> <span class="o">=</span> <span class="s1">'abc123'</span>
</code></pre></div></div> <p>ç„¶åæˆ‘ä»¬å¢åŠ 3ä¸ªå­é˜¶æ®µçš„æ—¶é—´åº¦é‡ï¼ˆå…¶ä¸­1å’Œ2ä¸ºä¹‹å‰å‰©ä½™çš„2æ¬¡æŸ¥è¯¢ï¼Œ3ä¸º1å’Œ2åˆå¹¶çš„æŸ¥è¯¢ï¼‰ï¼Œè·‘æµ‹ä¸€ä¸‹</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Stage</span> <span class="mi">1</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">255</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">2</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">137</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">3</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">1</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">4</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">483</span><span class="n">ms</span>
<span class="n">Sub</span><span class="o">-</span><span class="n">Stage</span> <span class="mi">5</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">740</span><span class="n">ms</span>
<span class="n">Sub</span><span class="o">-</span><span class="n">Stage</span> <span class="mi">5</span><span class="p">.</span><span class="mi">2</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">673</span><span class="n">ms</span>
<span class="n">Sub</span><span class="o">-</span><span class="n">Stage</span> <span class="mi">5</span><span class="p">.</span><span class="mi">3</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">433</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">5</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">1847</span><span class="n">ms</span>
</code></pre></div></div> <p>å¯ä»¥çœ‹åˆ°ï¼Œ1.3så¯ä»¥ç›´æ¥æ‰€è§åˆ°400msï¼Œå› ä¸ºå°‘äº†æ•°æ®é‡çš„æ¥å›ä¼ è¾“ï¼Œä¼ è¾“çš„æ•°æ®ä¹Ÿç›¸åº”çš„å‡å°‘äº†ï¼Œç”šè‡³å•æ¬¡çš„æ—¶é—´æ¶ˆè€—éƒ½æ¯”åˆ†å¼€çš„ä¸¤æ¬¡éƒ½ä½ã€‚</p> <p>æ•´ç†ä¸€ä¸‹ä»£ç ï¼š</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/final_code.2024-11-22_16-25-17-480.webp 480w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/final_code.2024-11-22_16-25-17-800.webp 800w,/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/final_code.2024-11-22_16-25-17-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-22-optimizing-slow-queries-from-15s-to-1s/final_code.2024-11-22_16-25-17.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> æœ€ç»ˆä¼˜åŒ–ä»£ç  </div> <p>æœ¬èº«å¾ˆå¤æ‚çš„é€»è¾‘æ­¤æ—¶å·²ç»å®Œå…¨ç®€åŒ–äº†ï¼Œå®ç°äº†æ•°æ®åº“æ“ä½œå¤æ‚è¯­å¥å’Œåº”ç”¨å±‚é€»è¾‘çš„å‰¥ç¦»äº†ï¼Œè¿™ä¹Ÿæ˜¯åˆ†å±‚çš„ä¸€ä¸ªæ¯”è¾ƒå®ç”¨çš„é€»è¾‘å’Œåº”ç”¨</p> <p>è·‘æµ‹ä¸€ä¸‹</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Stage</span> <span class="mi">1</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">213</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">2</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">118</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">3</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">3</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">4</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">486</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">5</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">496</span><span class="n">ms</span>
</code></pre></div></div> <p>å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»åœ¨msçº§åˆ«äº†ï¼Œè¿™è¾¹çœ‹ç€æ˜¯å·²ç»è¾¾åˆ°é¢„æœŸçš„ç›®æ ‡äº†ã€‚å¦å¤–è¿˜æœ‰ä¸€äº›ä¼˜åŒ–æ‰‹æ®µï¼Œæ¯”å¦‚æ•°æ®é›†çœŸçš„å¤§åˆ°ä¸€å®šé‡çº§ï¼ŒINå¤ªå¤šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘åˆ†é¡µæ‹‰å–ï¼Œä¸è¿‡æ­£å¦‚å‰é¢è¯´çš„ï¼Œé™¤äº†æ•°æ®åº“å¼•æ“å±‚æ¶ˆè€—ä»¥å¤–ï¼Œè¿˜æœ‰ç½‘ç»œå’Œåº”ç”¨å±‚ä¹Ÿä¼šæ¶ˆè€—ï¼Œæ‰€ä»¥æ˜¯éœ€è¦å–èˆçš„ã€‚</p> <p>è¿™é‡Œæˆ‘ä»¬ç æ‰äº†æœ€å¤§å¤´ä¹‹åï¼Œå¯ä»¥å›å¤´å¯¹å‰é¢çš„é˜¶æ®µä¹Ÿä¼˜åŒ–ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯é’ˆå¯¹æ‹‰å…¨åˆ—æ”¹æˆæ‹‰éœ€è¦çš„åˆ—ï¼Œè·‘æµ‹ä¸€ä¸‹çœ‹çœ‹</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Stage</span> <span class="mi">1</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">218</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">2</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">113</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">3</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">0</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">4</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">226</span><span class="n">ms</span>
<span class="n">Stage</span> <span class="mi">5</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">511</span><span class="n">ms</span>
</code></pre></div></div> <p>åˆ°è¿™é‡Œçš„è¿™æ³¢ä¼˜åŒ–å·²ç»å–å¾—ä¸é”™çš„æˆæœäº†ï¼Œè¿™è¾¹å…¶å®è¿˜æœ‰åŠæ³•è¿›ä¸€æ­¥ç»§ç»­ä¼˜åŒ–çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ¥å£ç‰µæ¶‰å¤ªå¤šçš„å†å²ä¸šåŠ¡é€»è¾‘ï¼Œå› æ­¤è¿™è¾¹æš‚æ—¶æ²¡æœ‰ç»§ç»­æ·±æŒ–ï¼Œè¿™ä¸ªå…¶å®ä¹Ÿæ˜¯å¾ˆå¤šè¿˜å€ºè¿‡ç¨‹ä¸­æœ€éš¾å—çš„ç‚¹ï¼Œä½ éœ€è¦ä¿æŒå…¼å®¹ï¼Œå¦‚æœå‰è¾ˆä»¬æ²¡è‰¯å¿ƒçš„å †ï¼Œé‚£å¤§æ¦‚è¿™ä¸ªè‰å°å¾ˆå®¹æ˜“åœ¨ä¼˜åŒ–é‡æ„è¿‡ç¨‹ä¸­ä¼šå´©å¡Œï¼Œç¥å¥½</p> <h2 id="ç»“è®º">ç»“è®º</h2> <p>å› ä¸ºè„±æ•çš„éœ€æ±‚ï¼Œæœ‰äº›æˆªå›¾å°±ä¸æ”¾äº†ï¼Œè™½ç„¶æˆ‘è§‰å¾—é‚£äº›æœ‰åŠ©äºç†è§£æ•´ä¸ªä¼˜åŒ–è¿‡ç¨‹ä¸­çš„æ€è·¯å’Œä¸€æ­¥ä¸€æ­¥çš„ä¼˜åŒ–å¸¦æ¥çš„ä»£ç å˜è¿ã€‚è¯´åˆ°è¿™é‡Œæœ‰æ—¶å€™æˆ‘ä»¬åœ¨å›¢é˜Ÿåä½œä¸­ä¼šæœ‰ç»“å¯¹Code Reviewæˆ–è€…å®šæœŸæŠ½æ ·ä»£ç è¯„å®¡çš„æ–¹å¼ï¼Œå…¶å®ä¹Ÿæ˜¯ä¿è¯ä¸€ä¸ªäººçš„æ€è·¯èƒ½ä¼ é€’ç»™å…¶ä»–äººï¼Œå¦å¤–ä¹Ÿèƒ½è®©å¥½çš„æ€æƒ³åœ¨å›¢é˜Ÿå†…éƒ¨ä¼ æ’­ï¼Œèƒ½è®©æ–°åŒå­¦æ›´å¿«é€Ÿè·Ÿä¸Šï¼Œå¹¶ä¸”é•¿æœŸä¿æŒå›¢é˜Ÿä»£ç è´¨é‡ã€å·¥ç¨‹èƒ½åŠ›å’Œåä½œèƒ½åŠ›ã€‚</p> <p>å¦å¤–å’±ä»¬è¿˜æ˜¯åº”è¯¥åšæŒå¯¹äº‹ä¸å¯¹äººï¼Œå› ä¸ºæ¯ä¸ªäººéƒ½æœ‰ä¸€æ®µæˆé•¿æœŸï¼Œå¹¶ä¸”å¾ˆå¤šäººåœ¨é¢ä¸´é«˜å‹æˆ–è€…é«˜é€Ÿå¢é•¿çš„ä¸šåŠ¡çš„æƒ…å†µä¸‹ï¼Œæœ‰å¾ˆå¤§çš„å¯èƒ½å‡ºç°æŠ€æœ¯å€ºï¼ˆ<del>ä¸ç„¶æŸèŠ‚å’ŒæŸå›¢çš„åŒºåˆ«ä»ä½•è€Œæ¥</del>ï¼‰ï¼Œå¹¶ä¸”ä¸ç®¡æ˜¯è°å†™çš„ä¸œè¥¿éƒ½æ˜¯æœ‰â€ä¿è´¨æœŸâ€œçš„ã€‚</p>]]></content><author><name></name></author><category term="DB"/><category term="SQL-OPTIMIZATION"/><summary type="html"><![CDATA[SQLæ…¢æŸ¥è¯¢æ˜¯è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ï¼Œä¼¼ä¹å¥½åƒä¸ä¼šåšç‚¹ä¼˜åŒ–éƒ½ä¸è¡Œã€‚æ…¢æŸ¥è¯¢ä¼˜åŒ–å…¶å®æœ‰å¾ˆå¤šæ‰‹æ®µï¼Œå¹¶ä¸”ä¹Ÿæ ¹æ®åº”ç”¨åœºæ™¯å’Œéœ€æ±‚è€Œå¼‚ï¼Œæˆ‘è§‰å¾—æ¯”è¾ƒé‡è¦çš„è¿˜æ˜¯äº†è§£åº•å±‚åŸç†ï¼Œè¿™æ ·ä¸Šå±‚åº”ç”¨å±‚æ€ä¹ˆå˜åŒ–éƒ½èƒ½æ¯”è¾ƒå¿«çš„æ‰¾åˆ°ä¼˜åŒ–çš„ç‚¹ã€‚å€Ÿç€è¿™ä¸ªæœºä¼šå°è°ˆä¸€ä¸‹SQLä¼˜åŒ–ä¸­çš„ä¸€äº›è¿‡ç¨‹å’Œæƒ³æ³•ã€‚]]></summary></entry><entry><title type="html">Gitå¤šé¡¹ç›®é…ç½®ç®¡ç†</title><link href="https://ifuryst.github.io/blog/2024/unified-git-management-for-multiple-git-repositories/" rel="alternate" type="text/html" title="Gitå¤šé¡¹ç›®é…ç½®ç®¡ç†"/><published>2024-11-11T15:08:27+00:00</published><updated>2024-11-11T15:08:27+00:00</updated><id>https://ifuryst.github.io/blog/2024/unified-git-management-for-multiple-git-repositories</id><content type="html" xml:base="https://ifuryst.github.io/blog/2024/unified-git-management-for-multiple-git-repositories/"><![CDATA[<p>å¹³æ—¶ä¼šå¤„ç†å¾ˆå¤šé¡¹ç›®ï¼Œè¿™æœŸé—´å°±ä¼šé‡åˆ°Gitç›¸å…³çš„é…ç½®ç®¡ç†é—®é¢˜ï¼Œä»¥å‰éƒ½æ˜¯æ‰‹åŠ¨ç®¡ç†ï¼Œä¼šé‡åˆ°é—æ¼çš„æƒ…å†µï¼Œç°åœ¨å¤„ç†çš„é¡¹ç›®å¤ªå¤šäº†ï¼Œå¼€æºç¤¾åŒºä¹Ÿä¼šå‚ä¸ä¸€äº›é¡¹ç›®çš„è´¡çŒ®ï¼Œå†æ‰‹åŠ¨ç®¡ç†å¾ˆéº»çƒ¦ï¼Œçœ‹äº†ä¸€ä¸‹Gitæ˜¯æ”¯æŒæ ¹æ®è·¯åŠ²æ¥èµ°é…ç½®çš„</p> <h2 id="gité…ç½®æ¥æº">Gité…ç½®æ¥æº</h2> <p>æ€»ä½“è€Œè¨€ï¼ŒGitè¯»å–é…ç½®ä¸»è¦æœ‰è¿™ä¹ˆå‡ ä¸ªæ¥æºï¼ˆä¼˜å…ˆçº§ä»ä½åˆ°é«˜ï¼‰ï¼š</p> <ol> <li>ç³»ç»Ÿçº§ï¼ˆsystemï¼‰é…ç½®ï¼š<code class="language-plaintext highlighter-rouge">/etc/gitconfig</code></li> <li>ç”¨æˆ·çº§ï¼ˆglobalï¼‰é…ç½®ï¼š<code class="language-plaintext highlighter-rouge">~/.gitconfig</code></li> <li>ä»“åº“çº§ï¼ˆlocalï¼‰é…ç½®ï¼šé¡¹ç›®ä¸‹çš„<code class="language-plaintext highlighter-rouge">.git/config</code></li> </ol> <h2 id="é…ç½®å‘½ä»¤">é…ç½®å‘½ä»¤</h2> <p>é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¼šæ¯”è¾ƒå¤šä½¿ç”¨2å’Œ3ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·çº§åˆ«çš„å…¨å±€é…ç½®å’Œå•ä»“åº“çº§åˆ«çš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”äº†ä»¥ä¸‹çš„å‘½ä»¤</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># å…¨å±€é…ç½®</span>
git config <span class="nt">--global</span> <span class="nt">--list</span>
<span class="c"># é…ç½®ç”¨æˆ·å</span>
git config <span class="nt">--global</span> user.name <span class="s1">'fake-name'</span>
<span class="c"># é…ç½®é‚®ç®±</span>
git config <span class="nt">--global</span> user.email <span class="s1">'fake@email.com'</span>
<span class="c"># é…ç½®GPGå¯†é’¥ID</span>
git config <span class="nt">--global</span> user.signingkey ABC123PGPKEYID

<span class="c"># ä»“åº“çº§é…ç½®</span>
git config <span class="nt">--list</span>
<span class="c"># é…ç½®ç”¨æˆ·å</span>
git config user.name <span class="s1">'fake-name'</span>
<span class="c"># é…ç½®é‚®ç®±</span>
git config user.email <span class="s1">'fake@email.com'</span>
<span class="c"># é…ç½®GPGå¯†é’¥ID</span>
git config user.signingkey ABC123PGPKEYID
</code></pre></div></div> <h2 id="ç»Ÿä¸€é…ç½®">ç»Ÿä¸€é…ç½®</h2> <p>ä¸Šé¢çš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥ä¸´æ—¶åº”å¯¹æŸäº›ä»“åº“ä¸´æ—¶æˆ–è€…å•ç‹¬è®¾ç½®ï¼Œä½†æ˜¯å¯¹äºå…¨å±€æ¥è¯´ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ¯æ¬¡æˆ‘ä»¬æ‹‰å–æˆ–è€…èµ·æ–°çš„ä»“åº“çš„æ—¶å€™è¦é‡å¤é…ç½®ï¼Œè¿™ä¼šå¾ˆçƒ¦äººï¼Œå¹¶ä¸”é‡ç‚¹æ˜¯å¾ˆå¤šæ—¶å€™ä¼šå¿˜è®°ï¼Œå› æ­¤ä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•æ˜¯æ ¹æ®åˆ†çº§é…ç½®ï¼Œåœ¨å…¨å±€åšå¥½é…ç½®ï¼Œæˆ‘ä¸ªäººçš„ä¹ æƒ¯æ˜¯ä¼šæ ¹æ®ç›®å½•æ¥åˆ’åˆ†ä¸åŒçš„ç»„ç»‡é¡¹ç›®ï¼Œäº’ä¸å¹²æ‰°</p> <p>æ¯”å¦‚æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ç»„ä¸åŒçš„ç›®å½•é‡Œä¼šåŒ…å«å„ç§é¡¹ç›®ï¼š</p> <ol> <li><code class="language-plaintext highlighter-rouge">/path/to/github/</code> åŒ…å«äº†åœ¨å¼€æºç¤¾åŒºçš„ä¸€äº›é¡¹ç›®</li> <li><code class="language-plaintext highlighter-rouge">/path/to/fake-org/</code> åŒ…å«äº†åœ¨æŸä¸ªç»„ç»‡çš„é¡¹ç›®</li> </ol> <p>æ­¤æ—¶åœ¨<code class="language-plaintext highlighter-rouge">~/.gitconfig</code>é‡Œå¯ä»¥è¿™æ ·é…ç½®</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>includeIf <span class="s2">"gitdir:/path/to/github/"</span><span class="o">]</span>
    path <span class="o">=</span> /path/to/.gitconfig.github

<span class="o">[</span>includeIf <span class="s2">"gitdir:/path/to/fake-org/"</span><span class="o">]</span>
    path <span class="o">=</span> /path/to/.gitconfig.fake-org
</code></pre></div></div> <p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹è¿™ä¸¤ä¸ªç›®å½•ä¸‹çš„é¡¹ç›®åˆ†åˆ«èµ°ä¸¤ä»½ä¸åŒçš„gité…ç½®</p> <p>æ¯”å¦‚<code class="language-plaintext highlighter-rouge">.gitconfig.github</code>çš„é…ç½®</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>user]
    name <span class="o">=</span> <span class="s2">"leo"</span>
    email <span class="o">=</span> <span class="s2">"my@email.com"</span>
    signingkey <span class="o">=</span> <span class="s2">"ABC123"</span>
</code></pre></div></div> <p>è€Œ<code class="language-plaintext highlighter-rouge">.gitconfig.fake-org</code>çš„é…ç½®</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>user]
    name <span class="o">=</span> <span class="s2">"fake-name"</span>
    email <span class="o">=</span> <span class="s2">"fake@email.com"</span>
    signingkey <span class="o">=</span> <span class="s2">"ABC456"</span>
</code></pre></div></div> <p>è¿™æ ·å°±å¯ä»¥ä¸€åŠ³æ°¸é€¸çš„è§£å†³å¤šé¡¹ç›®ä¸åŒGité…ç½®é—®é¢˜</p> <h2 id="å‚è€ƒ">å‚è€ƒ</h2> <ul> <li><a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt---global">https://git-scm.com/docs/git-config#Documentation/git-config.txtâ€”global</a></li> </ul>]]></content><author><name></name></author><category term="DevOps"/><category term="Git"/><summary type="html"><![CDATA[å¹³æ—¶ä¼šå¤„ç†å¾ˆå¤šé¡¹ç›®ï¼Œè¿™æœŸé—´å°±ä¼šé‡åˆ°Gitç›¸å…³çš„é…ç½®ç®¡ç†é—®é¢˜ï¼Œä»¥å‰éƒ½æ˜¯æ‰‹åŠ¨ç®¡ç†ï¼Œä¼šé‡åˆ°é—æ¼çš„æƒ…å†µï¼Œç°åœ¨å¤„ç†çš„é¡¹ç›®å¤ªå¤šäº†ï¼Œå¼€æºç¤¾åŒºä¹Ÿä¼šå‚ä¸ä¸€äº›é¡¹ç›®çš„è´¡çŒ®ï¼Œå†æ‰‹åŠ¨ç®¡ç†å¾ˆéº»çƒ¦ï¼Œçœ‹äº†ä¸€ä¸‹Gitæ˜¯æ”¯æŒæ ¹æ®è·¯åŠ²æ¥èµ°é…ç½®çš„]]></summary></entry><entry><title type="html">GOMAXPROCSï¼šGoçš„CPUæ ¸å¿ƒæ•°é™åˆ¶ä¸å®¹å™¨åŒ–ç¯å¢ƒä¸­çš„æ€§èƒ½ä¼˜åŒ–</title><link href="https://ifuryst.github.io/blog/2024/gomaxprocs-optimizing-go-performance-in-containers/" rel="alternate" type="text/html" title="GOMAXPROCSï¼šGoçš„CPUæ ¸å¿ƒæ•°é™åˆ¶ä¸å®¹å™¨åŒ–ç¯å¢ƒä¸­çš„æ€§èƒ½ä¼˜åŒ–"/><published>2024-11-06T13:08:27+00:00</published><updated>2024-11-06T13:08:27+00:00</updated><id>https://ifuryst.github.io/blog/2024/gomaxprocs-optimizing-go-performance-in-containers</id><content type="html" xml:base="https://ifuryst.github.io/blog/2024/gomaxprocs-optimizing-go-performance-in-containers/"><![CDATA[<p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼Œå…³äºåœ¨Cgroupsé™åˆ¶CPUèµ„æºçš„æƒ…å†µä¹‹ä¸‹ï¼Œè®¾ç½®å¯ç”¨æ ¸å¿ƒæ•°çš„æ—¶å€™ä¼šå¯¼è‡´ä¸€äº›æ€§èƒ½å·®å¼‚ï¼Œå› æ­¤å°±è¿™ä¸ªé—®é¢˜æ¢ç©¶äº†ä¸€ä¸‹</p> <h2 id="gomaxprocsæ˜¯ä»€ä¹ˆ">GOMAXPROCSæ˜¯ä»€ä¹ˆ</h2> <p>GOMAXPROCSæ˜¯runtimeé‡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œçœ‹ä¸‹å®˜æ–¹çš„ä»‹ç»</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// GOMAXPROCS sets the maximum number of CPUs that can be executing</span>
<span class="c">// simultaneously and returns the previous setting. It defaults to</span>
<span class="c">// the value of [runtime.NumCPU]. If n &lt; 1, it does not change the current setting.</span>
<span class="c">// This call will go away when the scheduler improves.</span>
<span class="k">func</span> <span class="n">GOMAXPROCS</span><span class="p">(</span><span class="n">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{}</span>
</code></pre></div></div> <p>ç®€å•çš„è¯´ï¼Œå°±æ˜¯ç”¨äºè®¾ç½®Goç¨‹åºèƒ½ç”¨çš„CPUæ ¸å¿ƒæ•°ï¼Œé»˜è®¤çš„è¯æƒ…å†µæ˜¯ä½¿ç”¨æ‰€æœ‰æ ¸å¿ƒï¼ˆä¹Ÿå°±æ˜¯runtime.NumCPUè·å–åˆ°çš„å€¼ï¼‰</p> <h2 id="gomaxprocsæœ‰ä»€ä¹ˆç”¨">GOMAXPROCSæœ‰ä»€ä¹ˆç”¨</h2> <p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œruntime.GOMAXPROCSå¤šç”¨æ¥æ§åˆ¶æ•´ä¸ªç¨‹åºçš„å¹¶å‘é‡ï¼ˆæˆ–è€…è¯´èµ„æºæ¶ˆè€—ï¼‰ï¼Œå½“è®¾ç½®å¤§äº†ï¼Œç¨‹åºè‡ªç„¶å°±èƒ½è·‘æ›´å¤šçš„åç¨‹ï¼Œåä¹‹ä¼šé™åˆ¶åŒä¸€æ—¶é—´çš„åç¨‹æ•°é‡ã€‚</p> <p>é€šè¿‡è¿™ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨ä¸€äº›åœºæ™¯ä¸‹æ§åˆ¶èµ„æºæ¶ˆè€—ï¼Œæ¯”å¦‚æœ‰ä¸€äº›èµ„æºæ¯”è¾ƒæ•æ„Ÿçš„è®¾å¤‡ï¼Œæˆ–è€…å°å®ä¾‹çš„åœºæ™¯ï¼Œå°¤å…¶é’ˆå¯¹ä»¥Kubernetesä¸ºä¸»çš„å®¹å™¨åŒ–åœºæ™¯ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šæ§å•å®ä¾‹çš„èµ„æºï¼Œç„¶åé…åˆå¤šå®ä¾‹å®ç°ç®—åŠ›åˆ‡å‰²æˆ–è€…å®¹ç¾ç­‰ç›®çš„ã€‚</p> <h2 id="å…·ä½“é—®é¢˜">å…·ä½“é—®é¢˜</h2> <p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¸ä¼šé‡åˆ°å¤ªå¤§é—®é¢˜ï¼ˆæˆ–è€…ä¸ä¼šæ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œä½†æ˜¯åœ¨ä¸€äº›åœºæ™¯è¯¸å¦‚é«˜å¹¶å‘ï¼Œå…³æ³¨æ—¶å»¶ï¼ˆP50ï¼ŒP99ç­‰ï¼‰ã€ååçš„åœºæ™¯ï¼Œå°±å¾ˆæœ‰å¯èƒ½ä¼šè¢«å½±å“åˆ°ã€‚</p> <p>å…·ä½“çš„é—®é¢˜æ˜¯ï¼Œå½“é€šè¿‡Cgroupsé™åˆ¶CPUçš„è¯ï¼Œå¯èƒ½å°±ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œå°¤å…¶æ˜¯ç°åœ¨å¾ˆå¤šæœåŠ¡æ˜¯é€šè¿‡Kubernetesã€Dockeræ‹‰èµ·çš„ï¼Œåœ¨å®¹å™¨ç¯å¢ƒé‡Œï¼Œå¤–éƒ¨å¯èƒ½ä¼šé™åˆ¶CPUã€å†…å­˜çš„æœ€å¤§å€¼ï¼Œè¿™ç§æƒ…å†µåœ¨èµ„æºè·‘æ»¡çš„æƒ…å†µä¸‹æœ‰å¯èƒ½ä¼šå¯¼è‡´å®é™…æ•ˆç‡æ¯”åšäº†åˆé€‚çš„é™åˆ¶æ¥å¾—æ›´ä½çš„æƒ…å†µ</p> <p>ä¸€æ­¥ä¸€æ­¥æ¥çœ‹ï¼Œå¯èƒ½ä¼šæ›´åŠ å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬æ‹‰ä¸€ä¸ªå®¹å™¨</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">rm</span> <span class="o">--</span><span class="n">cpus</span><span class="o">=</span><span class="s">"2"</span> <span class="o">-</span><span class="n">m</span> <span class="m">512</span><span class="n">m</span> <span class="n">golang</span><span class="o">:</span><span class="m">1.23</span><span class="o">-</span><span class="n">bullseye</span> <span class="n">bash</span>
</code></pre></div></div> <p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™è¾¹æˆ‘ä»¬é™åˆ¶äº†2æ ¸ï¼Œ512Mçš„ä½¿ç”¨ç‡é™åˆ¶ï¼Œè¿›åˆ°å®¹å™¨çœ‹çœ‹</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/cpu_in_container.2024-11-06_16-34-04-480.webp 480w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/cpu_in_container.2024-11-06_16-34-04-800.webp 800w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/cpu_in_container.2024-11-06_16-34-04-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/cpu_in_container.2024-11-06_16-34-04.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> CPU and Memory in Container </div> <p>å¯ä»¥çœ‹åˆ°ï¼ŒCPUå’Œå†…å­˜è¿˜æ˜¯è¯»å–åˆ°äº†å®¿ä¸»æœºçš„å®é™…å¤§å°ï¼ŒåŒæ—¶æˆ‘ä»¬çœ‹çœ‹Cgroups</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/cgroups_in_container.2024-11-06_16-40-12-480.webp 480w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/cgroups_in_container.2024-11-06_16-40-12-800.webp 800w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/cgroups_in_container.2024-11-06_16-40-12-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/cgroups_in_container.2024-11-06_16-40-12.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> Cgroups in Container </div> <p>å¯ä»¥çœ‹åˆ°Cgroupsç¡®å®æ˜¯æœ‰è®¾ç½®çš„ï¼Œè¿™è¾¹200000/100000=2æ ¸</p> <p>æˆ‘ä»¬è·‘ä¸ªGoç¨‹åºçœ‹çœ‹</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/gomaxprocs_demo.2024-11-06_16-37-08-480.webp 480w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/gomaxprocs_demo.2024-11-06_16-37-08-800.webp 800w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/gomaxprocs_demo.2024-11-06_16-37-08-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/gomaxprocs_demo.2024-11-06_16-37-08.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> GOMAXPROCS Demo </div> <p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™è¾¹å®é™…ä¸Šè·å–åˆ°çš„ä¹Ÿæ˜¯12æ ¸ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœç”¨é»˜è®¤çš„runtime.GOMAXPROCS(0)å°±ä¼šå°†æœ€å¤§çš„æ ¸å¿ƒæ•°è®¾ç½®æˆ12ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬é€šè¿‡Cgroupsé™åˆ¶çš„æ˜¯2ä¸ªæ ¸å¿ƒï¼Œæ‰€ä»¥åœ¨2æ ¸è·‘æ»¡çš„æƒ…å†µä¹‹ä¸‹å°±ä¼šå‡ºç°å‰é¢æåˆ°çš„é—®é¢˜ï¼Œè¡¨ç°ä¸ºï¼š</p> <p><strong>å¦‚æœæˆ‘ä»¬è®¾ç½®æœ€å¤§å¯ç”¨ä¸º12çš„æƒ…å†µä¸‹è·å¾—çš„æ€§èƒ½æ˜¯ä¸å¦‚æˆ‘ä»¬è®¾ç½®ä¸º2</strong></p> <h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2> <p>å…ˆè¯´ç»“è®ºï¼Œæ–¹ä¾¿ä¸‹é¢çš„å…¨æµç¨‹å±•ç¤ºã€‚</p> <p>æœ€ç›´æ¥çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å’Œå¯¹åº”çš„å¤–éƒ¨é™åˆ¶ç»Ÿä¸€ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡é…ç½®ä¼ é€’æ¥åšï¼Œä¸å¤Ÿä¼šæ¯”è¾ƒåˆ»æ¿ï¼ŒæŸäº›æƒ…å†µä¸é€‚åº”æˆ–è€…ä¸çµæ´»ã€‚</p> <p>å¦‚æœæ˜¯Cgroupsè¿™ç§æƒ…å†µéœ€è¦åŠ¨æ€è¯»å–çš„è¯ï¼Œå°±éœ€è¦å»è¯»å–Cgroupsçš„é…ç½®ï¼ŒCgroups v1å’Œv2æœ‰æœ‰äº›å‡ºå…¥ï¼Œæ‰€å¹¸çš„æ˜¯æœ‰å¯¹åº”çš„æ–¹æ¡ˆï¼ŒUberçš„<a href="https://github.com/uber-go/automaxprocs">automaxprocs</a>ï¼Œé‡Œé¢é’ˆå¯¹Cgroups v1å’Œv2åšäº†é€‚é…è¯»å–ï¼Œåªæ”¯æŒLinuxã€‚ï¼ˆå…³äºCgroupsåç»­æœ‰æœºä¼šå†å±•å¼€èŠèŠï¼Œè¿™è¾¹ä¸å±•å¼€äº†ï¼‰</p> <p>å€¼å¾—ä¸€æçš„æ˜¯Uberå¼€æºè¿™ä¸ªç®€å•çš„å·¥å…·ä¹Ÿæ˜¯å› ä¸ºä»–ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šé‡åˆ°äº†P50ã€P99è¢«è¿™ä¸ªé—®é¢˜å½±å“</p> <h2 id="å…¨æµç¨‹">å…¨æµç¨‹</h2> <p>æ¥ä¸‹é‡Œæˆ‘ä»¬ä¸€èµ·é€šè¿‡ä»£ç æ¥è§‚æµ‹æ•´ä¸ªç°è±¡ã€‚</p> <p>æˆ‘å¼„äº†ä¸€ä¸ªDemoæ¥æ¼”ç¤ºè¿™ä¸ªç»“æœï¼Œå…·ä½“ä»£ç å‚è§ï¼š<a href="https://github.com/iFurySt/GoMaxProcsBench">GoMaxProcsBench</a></p> <p>æˆ‘ä»¬çœ‹ä¸‹cmd/bench/main.goï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"flag"</span>
	<span class="s">"fmt"</span>
	<span class="s">"go.uber.org/automaxprocs/maxprocs"</span>
	<span class="s">"log"</span>
	<span class="s">"os"</span>
	<span class="s">"os/signal"</span>
	<span class="s">"runtime"</span>
	<span class="s">"sync/atomic"</span>
	<span class="s">"syscall"</span>
	<span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="m">1</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">n</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="m">2</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">var</span> <span class="p">(</span>
	<span class="n">mode</span>   <span class="kt">int</span>
	<span class="n">ts</span>     <span class="n">time</span><span class="o">.</span><span class="n">Duration</span>
	<span class="n">silent</span> <span class="kt">bool</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mode</span><span class="p">,</span> <span class="s">"mode"</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="s">"0: auto, 1: runtime"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">DurationVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ts</span><span class="p">,</span> <span class="s">"ts"</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="s">"time to run"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">BoolVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">silent</span><span class="p">,</span> <span class="s">"silent"</span><span class="p">,</span> <span class="no">false</span><span class="p">,</span> <span class="s">"silent mode"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">Parse</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">Printf</span><span class="p">(</span><span class="s">"mode: %d, ts: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="m">1</span> <span class="p">{</span>
		<span class="n">runtime</span><span class="o">.</span><span class="n">GOMAXPROCS</span><span class="p">(</span><span class="n">runtime</span><span class="o">.</span><span class="n">NumCPU</span><span class="p">())</span>
		<span class="n">Printf</span><span class="p">(</span><span class="s">"GOMAXPROCS: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">runtime</span><span class="o">.</span><span class="n">GOMAXPROCS</span><span class="p">(</span><span class="m">0</span><span class="p">))</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">maxprocs</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">maxprocs</span><span class="o">.</span><span class="n">Logger</span><span class="p">(</span><span class="n">Printf</span><span class="p">))</span>
	<span class="p">}</span>

	<span class="k">var</span> <span class="p">(</span>
		<span class="n">st</span>     <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
		<span class="n">count</span>  <span class="n">atomic</span><span class="o">.</span><span class="n">Int64</span>
		<span class="n">sigs</span>   <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="n">os</span><span class="o">.</span><span class="n">Signal</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
		<span class="n">ctx</span>    <span class="n">context</span><span class="o">.</span><span class="n">Context</span>
		<span class="n">cancel</span> <span class="n">context</span><span class="o">.</span><span class="n">CancelFunc</span>
	<span class="p">)</span>

	<span class="k">if</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="p">{</span>
		<span class="n">ctx</span><span class="p">,</span> <span class="n">cancel</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">WithTimeout</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">(),</span> <span class="n">ts</span><span class="p">)</span>
		<span class="k">defer</span> <span class="n">cancel</span><span class="p">()</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="p">}</span>

	<span class="n">signal</span><span class="o">.</span><span class="n">Notify</span><span class="p">(</span><span class="n">sigs</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGQUIT</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
	<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="n">Printf</span><span class="p">(</span><span class="s">"count: %d, time: %v, qps: %.0f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">st</span><span class="p">),</span>
			<span class="kt">float64</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span><span class="o">/</span><span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">st</span><span class="p">)</span><span class="o">.</span><span class="n">Seconds</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">silent</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%.0f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="kt">float64</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span><span class="o">/</span><span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">st</span><span class="p">)</span><span class="o">.</span><span class="n">Seconds</span><span class="p">())</span>
		<span class="p">}</span>
	<span class="p">}()</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="k">select</span> <span class="p">{</span>
		<span class="k">case</span> <span class="o">&lt;-</span><span class="n">ctx</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span><span class="o">:</span>
			<span class="k">return</span>
		<span class="k">case</span> <span class="o">&lt;-</span><span class="n">sigs</span><span class="o">:</span>
			<span class="k">return</span>
		<span class="k">default</span><span class="o">:</span>
			<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
				<span class="n">_</span> <span class="o">=</span> <span class="n">fib</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
				<span class="n">count</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
			<span class="p">}()</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">Printf</span><span class="p">(</span><span class="n">format</span> <span class="kt">string</span><span class="p">,</span> <span class="n">v</span> <span class="o">...</span><span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="n">silent</span> <span class="p">{</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">v</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>æ•´ä½“é€»è¾‘å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä»ä¸Šåˆ°ä¸‹çœ‹ä¸‹</p> <p>æˆ‘ä»¬ç”¨ä¸€ä¸ªfibonacciæ¥æ¨¡æ‹Ÿè€—æ—¶çš„è®¡ç®—ä»»åŠ¡</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="m">1</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">n</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="m">2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>æˆ‘ä»¬å®šä¹‰å‡ ä¸ªå‚æ•°</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="p">(</span>
	<span class="n">mode</span>   <span class="kt">int</span>
	<span class="n">ts</span>     <span class="n">time</span><span class="o">.</span><span class="n">Duration</span>
	<span class="n">silent</span> <span class="kt">bool</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mode</span><span class="p">,</span> <span class="s">"mode"</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="s">"0: auto, 1: runtime"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">DurationVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ts</span><span class="p">,</span> <span class="s">"ts"</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="s">"time to run"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">BoolVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">silent</span><span class="p">,</span> <span class="s">"silent"</span><span class="p">,</span> <span class="no">false</span><span class="p">,</span> <span class="s">"silent mode"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">Parse</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div> <p>åˆ†åˆ«æ˜¯modeæ¥æŒ‡å®šèµ°runtime.GOMAXPROCSè¿˜æ˜¯automaxprocs/maxprocs</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">Printf</span><span class="p">(</span><span class="s">"mode: %d, ts: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="m">1</span> <span class="p">{</span>
		<span class="n">runtime</span><span class="o">.</span><span class="n">GOMAXPROCS</span><span class="p">(</span><span class="n">runtime</span><span class="o">.</span><span class="n">NumCPU</span><span class="p">())</span>
		<span class="n">Printf</span><span class="p">(</span><span class="s">"GOMAXPROCS: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">runtime</span><span class="o">.</span><span class="n">GOMAXPROCS</span><span class="p">(</span><span class="m">0</span><span class="p">))</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">maxprocs</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">maxprocs</span><span class="o">.</span><span class="n">Logger</span><span class="p">(</span><span class="n">Printf</span><span class="p">))</span>
	<span class="p">}</span>
</code></pre></div></div> <p>å¦‚æœæœ‰æŒ‡å®štså°±æ˜¯è¿è¡Œæ—¶é•¿ï¼Œæˆ‘ä»¬å°±é€šè¿‡contextæ¥æ§åˆ¶ç¨‹åºåˆ°è¾¾æ—¶é—´é€€å‡º</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">var</span> <span class="p">(</span>
		<span class="n">st</span>     <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
		<span class="n">count</span>  <span class="n">atomic</span><span class="o">.</span><span class="n">Int64</span>
		<span class="n">sigs</span>   <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="n">os</span><span class="o">.</span><span class="n">Signal</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
		<span class="n">ctx</span>    <span class="n">context</span><span class="o">.</span><span class="n">Context</span>
		<span class="n">cancel</span> <span class="n">context</span><span class="o">.</span><span class="n">CancelFunc</span>
	<span class="p">)</span>

	<span class="k">if</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="p">{</span>
		<span class="n">ctx</span><span class="p">,</span> <span class="n">cancel</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">WithTimeout</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">(),</span> <span class="n">ts</span><span class="p">)</span>
		<span class="k">defer</span> <span class="n">cancel</span><span class="p">()</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="p">}</span>
</code></pre></div></div> <p>ç›‘å¬ä¸€ä¸‹ä¿¡å·é‡ï¼Œåœ¨æ²¡æœ‰æŒ‡å®šæ—¶é—´çš„æ—¶å€™å¯ä»¥Ctrl+Cæ¥åœæ­¢è·‘æµ‹çš„ç¨‹åº</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">signal</span><span class="o">.</span><span class="n">Notify</span><span class="p">(</span><span class="n">sigs</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGQUIT</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
	<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="n">Printf</span><span class="p">(</span><span class="s">"count: %d, time: %v, qps: %.0f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">st</span><span class="p">),</span>
			<span class="kt">float64</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span><span class="o">/</span><span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">st</span><span class="p">)</span><span class="o">.</span><span class="n">Seconds</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">silent</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%.0f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="kt">float64</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span><span class="o">/</span><span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">st</span><span class="p">)</span><span class="o">.</span><span class="n">Seconds</span><span class="p">())</span>
		<span class="p">}</span>
	<span class="p">}()</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="k">select</span> <span class="p">{</span>
		<span class="k">case</span> <span class="o">&lt;-</span><span class="n">ctx</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span><span class="o">:</span>
			<span class="k">return</span>
		<span class="k">case</span> <span class="o">&lt;-</span><span class="n">sigs</span><span class="o">:</span>
			<span class="k">return</span>
		<span class="k">default</span><span class="o">:</span>
			<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
				<span class="n">_</span> <span class="o">=</span> <span class="n">fib</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
				<span class="n">count</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
			<span class="p">}()</span>
		<span class="p">}</span>
	<span class="p">}</span>
</code></pre></div></div> <p>é€šè¿‡foråˆ†åˆ«åœ¨contextã€ä¿¡å·é‡å’Œç¨‹åºä¹‹é—´å¾ªç¯ï¼Œæ‰§è¡Œéƒ½æ˜¯ç›´æ¥å¼€ä¸ªæ–°çš„åç¨‹è·‘</p> <p>æˆ‘ä»¬è·‘ä¸€ä¸‹çœ‹çœ‹ã€‚è¿™è¾¹å¯ä»¥ç›´æ¥é€šè¿‡repoé‡Œçš„docker-compose.ymlå»æ‹‰èµ·å®¹å™¨æµ‹è¯•ï¼Œå·²ç»é…ç½®å¥½äº†</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker compose up <span class="nt">-d</span>
docker compose <span class="nb">exec </span>golang bash
</code></pre></div></div> <p>æˆ‘ä»¬åˆ†åˆ«è·‘æµ‹ä¸€ä¸‹ä¸¤ç§æ¨¡å¼ï¼Œåˆ†åˆ«è·‘5s</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/bench.2024-11-06_17-33-16-480.webp 480w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/bench.2024-11-06_17-33-16-800.webp 800w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/bench.2024-11-06_17-33-16-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/bench.2024-11-06_17-33-16.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> Bench for GOMAXPROCS and AUTOMAXPROCS </div> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@da9d799578df:/go/src/GoMaxProcsBench# go run cmd/bench/main.go <span class="nt">--ts</span> 5s <span class="nt">--mode</span> 0
2024/11/06 09:32:45 mode: 0, ts: 5s
2024/11/06 09:32:45 maxprocs: Updating <span class="nv">GOMAXPROCS</span><span class="o">=</span>2: determined from CPU quota
2024/11/06 09:32:50 count: 15323801, <span class="nb">time</span>: 5.000015461s, qps: 3064751
root@da9d799578df:/go/src/GoMaxProcsBench# go run cmd/bench/main.go <span class="nt">--ts</span> 5s <span class="nt">--mode</span> 1
2024/11/06 09:32:51 mode: 1, ts: 5s
2024/11/06 09:32:51 GOMAXPROCS: 12
2024/11/06 09:32:56 count: 8984694, <span class="nb">time</span>: 5.001722252s, qps: 1796320
</code></pre></div></div> <p>å¯ä»¥çœ‹åˆ°å’Œæœ€æ—©åˆ†æçš„ä¸€æ ·ï¼Œä¸€ä¸ªç”¨äº†2æ ¸ä¸€ä¸ªç”¨äº†12æ ¸è·‘ï¼Œç¨‹åºä¼šæ‰“å°fibè¿è¡Œçš„æ¬¡æ•°å’Œæ€»è€—æ—¶ï¼Œç„¶åæ‰“å°QPSï¼Œè¿™è¾¹å•æ¬¡æ— æ³•ä»£è¡¨æ•´ä½“æƒ…å†µï¼Œæˆ‘åŠ äº†ä¸€ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡cmd/stats/main.goæ¥è·‘å¤šæ¬¡ç®—ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"flag"</span>
	<span class="s">"fmt"</span>
	<span class="s">"log"</span>
	<span class="s">"os/exec"</span>
	<span class="s">"strconv"</span>
	<span class="s">"strings"</span>
	<span class="s">"time"</span>
<span class="p">)</span>

<span class="k">var</span> <span class="p">(</span>
	<span class="n">mode</span>  <span class="kt">int</span>
	<span class="n">ts</span>    <span class="n">time</span><span class="o">.</span><span class="n">Duration</span>
	<span class="n">times</span> <span class="kt">int</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mode</span><span class="p">,</span> <span class="s">"mode"</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="s">"0: auto, 1: runtime"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">DurationVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ts</span><span class="p">,</span> <span class="s">"ts"</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="s">"time to run"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">times</span><span class="p">,</span> <span class="s">"times"</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="s">"times to run"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">Parse</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">total</span> <span class="kt">int64</span> <span class="o">=</span> <span class="m">0</span>
	<span class="n">cnt</span> <span class="o">:=</span> <span class="m">0</span>
	<span class="k">for</span> <span class="k">range</span> <span class="n">times</span> <span class="p">{</span>
		<span class="n">cmd</span> <span class="o">:=</span> <span class="n">exec</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s">"go"</span><span class="p">,</span> <span class="s">"run"</span><span class="p">,</span> <span class="s">"cmd/bench/main.go"</span><span class="p">,</span>
			<span class="s">"--silent"</span><span class="p">,</span> <span class="s">"-mode"</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprint</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span> <span class="s">"-ts"</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprint</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">String</span><span class="p">()))</span>

		<span class="n">output</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">CombinedOutput</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Failed to execute command: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="p">}</span>
		<span class="n">qps</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">TrimSpace</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">output</span><span class="p">)),</span> <span class="m">10</span><span class="p">,</span> <span class="m">64</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Failed to parse output: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="p">}</span>
		<span class="n">total</span> <span class="o">+=</span> <span class="n">qps</span>
		<span class="n">cnt</span><span class="o">++</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Average QPS: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">total</span><span class="o">/</span><span class="kt">int64</span><span class="p">(</span><span class="n">cnt</span><span class="p">))</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"No valid result</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>æˆ‘ä»¬åˆ†åˆ«è·‘ä¸ª10æ¬¡çœ‹çœ‹</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/stats.2024-11-06_17-40-44-480.webp 480w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/stats.2024-11-06_17-40-44-800.webp 800w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/stats.2024-11-06_17-40-44-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/stats.2024-11-06_17-40-44.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> Stats for GOMAXPROCS and AUTOMAXPROCS </div> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@da9d799578df:/go/src/GoMaxProcsBench# go run cmd/stats/main.go <span class="nt">--ts</span> 5s <span class="nt">--mode</span> 0 <span class="nt">--times</span> 10
2024/11/06 09:36:29 Average QPS: 3010903
root@da9d799578df:/go/src/GoMaxProcsBench# go run cmd/stats/main.go <span class="nt">--ts</span> 5s <span class="nt">--mode</span> 1 <span class="nt">--times</span> 10
2024/11/06 09:37:33 Average QPS: 2408036
root@da9d799578df:/go/src/GoMaxProcsBench# go run cmd/stats/main.go <span class="nt">--ts</span> 5s <span class="nt">--mode</span> 0 <span class="nt">--times</span> 10
2024/11/06 09:38:41 Average QPS: 2896338
root@da9d799578df:/go/src/GoMaxProcsBench# go run cmd/stats/main.go <span class="nt">--ts</span> 5s <span class="nt">--mode</span> 1 <span class="nt">--times</span> 10
2024/11/06 09:40:25 Average QPS: 2364868
</code></pre></div></div> <p>å¯ä»¥çœ‹åˆ°QPSçš„å·®å¼‚äº†ï¼Œè¿™ä¸ªcaseä¸‹ç²—ç•¥ä¼°è®¡æœ‰20%çš„æŸè€—</p> <p>è¿™ä¸ªæ—¶å€™å¦‚æœçœ‹å®¹å™¨çš„CPUä½¿ç”¨ç‡å¯ä»¥å‘ç°ï¼Œé™åˆ¶åœ¨2æ ¸çš„ä½¿ç”¨ç‡åè€Œæ›´å°‘ï¼Œå¤§æ¦‚åœ¨180%ï¼Œè€Œé™åˆ¶åœ¨12æ ¸çš„CPUä½¿ç”¨ç‡æ›´é«˜ï¼Œå¤§æ¦‚200%-210%</p> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/gomaxprocs_cpu_usage.2024-11-06_17-36-34-480.webp 480w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/gomaxprocs_cpu_usage.2024-11-06_17-36-34-800.webp 800w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/gomaxprocs_cpu_usage.2024-11-06_17-36-34-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/gomaxprocs_cpu_usage.2024-11-06_17-36-34.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> GOMAXPROCS CPU Usage </div> <div class="row mt-3"> <div class="col-sm mt-0 mb-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/automaxprocs_cpu_usage.2024-11-06_17-37-06-480.webp 480w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/automaxprocs_cpu_usage.2024-11-06_17-37-06-800.webp 800w,/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/automaxprocs_cpu_usage.2024-11-06_17-37-06-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/2024-11-06-gomaxprocs-optimizing-go-performance-in-containers/automaxprocs_cpu_usage.2024-11-06_17-37-06.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption mt-0"> AUTOMAXPROCS CPU Usage </div> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CONTAINER ID   NAME                       CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O         PIDS
da9d799578df   gomaxprocsbench-golang-1   183.19%   113.3MiB / 200MiB     56.65%    69kB / 3.29kB     135MB / 195MB     53
da9d799578df   gomaxprocsbench-golang-1   210.74%   80.86MiB / 200MiB     40.43%    69kB / 3.29kB     135MB / 195MB     69
</code></pre></div></div> <h2 id="ç»“è®º">ç»“è®º</h2> <p>ä»¥å‰æ²¡æœ‰ç•™æ„åˆ°è¿™ä¸ªç°è±¡çš„æƒ…å†µä¹‹ä¸‹ï¼Œç»å¸¸ä¼šè§‰å¾—åœ¨å®¹å™¨å±‚é¢é€šè¿‡Cgroupsæ¥åšäº†é™åˆ¶åšå…œåº•ï¼Œè§‰å¾—éå¸¸ä¿é™©ï¼Œä»æŸç§è§’åº¦æ¥è¯´ä¹Ÿæ²¡é”™ï¼Œå°±æ˜¯æ²¡æœ‰å‘ç°åœ¨CPUé«˜è´Ÿè½½çš„æƒ…å†µä¹‹ä¸‹ï¼Œå¯èƒ½ä¼šå› ä¸ºé”™è¯¯çš„é…ç½®å¯¼è‡´æ€§èƒ½çš„ä¸‹é™ã€‚</p> <p>å¾ˆæœ‰è¶£çš„ä¸€æ¬¡æ¢ç´¢ï¼Œåœ¨å¸¸è§„çš„ç ”å‘è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šé—®é¢˜ä¸ä¼šå‡¸æ˜¾çš„ï¼Œåªæœ‰åœ¨è¿½æ±‚ä¸€äº›æè‡´çš„æƒ…å†µä¸‹ï¼Œä¸æ–­å»æŠ æ€§èƒ½æŸè€—çš„æƒ…å†µæ‰ä¼šå¼€å§‹å…³æ³¨è¿™äº›é—®é¢˜ï¼Œä½†æ˜¯å¾€å¾€æ˜¯è¿™äº›ä¸œè¥¿æ‰æ˜¯å‰è¿›è·¯ä¸Šæœ€å¤§çš„åŠ©æ¨å™¨ï¼Œå¦åˆ™åå¹´å¦‚ä¸€æ—¥çš„Codingï¼Œæœ€åå°±æ˜¯LLMå¸®ä½ æ´—å¤´ã€‚</p> <h2 id="å‚è€ƒ">å‚è€ƒ</h2> <ul> <li><a href="https://github.com/uber-go/automaxprocs">https://github.com/uber-go/automaxprocs</a></li> <li><a href="https://github.com/iFurySt/GoMaxProcsBench">https://github.com/iFurySt/GoMaxProcsBench</a></li> </ul>]]></content><author><name></name></author><category term="Coding"/><category term="Go"/><summary type="html"><![CDATA[æœ€è¿‘é‡åˆ°ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼Œå…³äºåœ¨Cgroupsé™åˆ¶CPUèµ„æºçš„æƒ…å†µä¹‹ä¸‹ï¼Œè®¾ç½®å¯ç”¨æ ¸å¿ƒæ•°çš„æ—¶å€™ä¼šå¯¼è‡´ä¸€äº›æ€§èƒ½å·®å¼‚ï¼Œå› æ­¤å°±è¿™ä¸ªé—®é¢˜æ¢ç©¶äº†ä¸€ä¸‹]]></summary></entry><entry><title type="html">å…³äºä¸­å›½é…’åœºæ–‡åŒ–çš„æ€è€ƒ</title><link href="https://ifuryst.github.io/blog/2024/reflections-on-chinas-drinking-culture/" rel="alternate" type="text/html" title="å…³äºä¸­å›½é…’åœºæ–‡åŒ–çš„æ€è€ƒ"/><published>2024-10-30T15:47:27+00:00</published><updated>2024-10-30T15:47:27+00:00</updated><id>https://ifuryst.github.io/blog/2024/reflections-on-chinas-drinking-culture</id><content type="html" xml:base="https://ifuryst.github.io/blog/2024/reflections-on-chinas-drinking-culture/"><![CDATA[<p>ç‰›é¥®ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§„çš„å°è±¡ï¼Œå´ä¹Ÿè›®ç¬¦åˆç°çŠ¶çš„ã€‚</p> <p>åœ¨ä¸­å›½çš„é…’åœºä¹‹ä¸Šï¼Œç‰›é¥®çš„æ˜¯é…’ï¼Œä½†æ˜¯å“çš„å´æ˜¯äººæƒ…å’Œåˆ©ç›Šã€‚ä¸­æ€§å®¢è§‚çš„æè¿°ï¼Œæ²¡æœ‰è¤’ä¹‰ä¹Ÿæ²¡æœ‰è´¬ä¹‰ã€‚</p> <p>å°±æ‹¿æˆ‘æ‰€åœ¨çš„åœ°åŒºä¸¾ä¾‹ï¼Œåœ¨é…’æ¡Œä¹‹ä¸Šï¼Œæ­£å¸¸æ˜¯ä¸»äººä¼šååœ¨é¢æœå¤§é—¨çš„ä¸­é—´ä½ç½®ï¼Œè¿™æ ·æ˜¯èƒ½åœ¨æ¯ä½æ¥å®¾è¿›æ¥çš„æ—¶å€™ç¬¬ä¸€æ—¶é—´çœ‹åˆ°ï¼Œå¹¶ä¸”ä¸€ä¸ªæ–°è¿›æ¥çš„äººç¬¬ä¸€çœ¼ä¹Ÿé€šå¸¸ä¼šå…ˆçœ‹åˆ°ååœ¨å¯¹é¢ä¸­é—´ä½ç½®çš„ä¸»äººï¼Œåˆä¹æƒ…ç†ï¼Œä¸€ä¸ªå°ç»†èŠ‚ï¼Œé€šå¸¸è¿™ä¸ªä½ç½®çš„äººå°±æ˜¯æé’±è¯·å®¢çš„äººï¼Œä¸‹æ¬¡ä½ å¯ç¨å¾®ç•™æ„ä¸€ä¸‹ã€‚</p> <p>é€šå¸¸åœ¨é…’æ¡Œä¹‹ä¸Šï¼Œä¼šæœ‰é€šå…³çš„â€œä»ªå¼â€æˆ–ä¹ ä¿—ï¼ŒæŒ‡çš„æ˜¯åœ¨åœºçš„æ¯ä¸€ä½äººéƒ½ä¼šä¸»åŠ¨å’Œåˆ«äººå–ä¸€æ¯é…’ï¼Œä¸¤ä¸ªå…³é”®ç‚¹ï¼š</p> <ul> <li>ä¸»åŠ¨</li> <li>å–é…’</li> </ul> <p>é€šå¸¸æ˜¯ä»ä½ çš„å·¦æ‰‹è¾¹æˆ–è€…å³æ‰‹è¾¹èµ·åŠ¿ï¼Œä¸€è·¯æ‰“ä¸‹å»ï¼Œåˆ«äººæ‰¾ä½ å–çš„ä¸ç®—ã€‚ä¸çŸ¥è¿™ç§æƒ¯ä¾‹çš„ç”±æ¥ï¼Œä½†æ˜¯ä¹æƒ³ä¹‹ä¸‹æ˜¯æœ‰é‚£ä¹ˆå‡ åˆ†åˆç†æ€§åœ¨å…¶é—´ã€‚é€šå¸¸åˆ«äººæ‰¾ä½ çš„è¯ï¼Œä½ ä¼šæ¯”è¾ƒæœ‰â€œæ„Ÿè§‰â€ï¼Œä½ ä¼šç•™æ„åˆ°å¯¹æ–¹ï¼Œæ‰€ä»¥ä¸»åŠ¨æ‰¾åœ¨åœºçš„æ¯ä¸ªäººå–ä¸€æ¯é…’ï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªè®¤è¯†å¯¹æ–¹çš„å¥‘æœºï¼ŒåŒæ—¶ä¹Ÿèƒ½ç»™å¯¹æ–¹ä¸€ç§ä½ é‡è§†ä»–ï¼Œæƒ³æ•¬ä»–ä¸€æ¯é…’çš„æ„Ÿè§‰ã€‚</p> <p>æˆ‘å‘ç°ï¼Œè¿˜è›®å¤šäººåŒæ¶ä¸­å›½çš„é…’åœºæ–‡åŒ–ï¼Œä¹Ÿå­˜åœ¨ä¸€å®šçš„åˆç†æ€§ï¼Œå…¶ä¸­æœ‰ä¸ªåŸå› å°±åƒé‚£å¥è¯è¯´çš„ä¸€æ ·â€œä¸ä¿¡ä¸”çœ‹æ¯ä¸­é…’ï¼Œæ¯æ¯å…ˆæ•¬æœ‰é’±äººâ€ï¼Œå“ˆå“ˆï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ç°è±¡ï¼Œå……åˆ†ä½“ç°äººæ€§çš„å¼ åŠ›ã€‚å¦å¤–ä¸€äº›æ–¹é¢å…¶å®æ ¹æºå’Œå‰é¢è¿™ä¸ªç‚¹ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œåœ¨é…’åœºä¹‹ä¸Šæ˜¯éå¸¸èƒ½ä½“ç°â€œé˜¶çº§â€çš„ï¼Œä¸€äº›äººä¼šæ„Ÿè§‰åˆ°éå¸¸pushï¼Œéå¸¸ä¸é€‚çš„åŸå› ä¹Ÿæºäºæ­¤ã€‚é…’åœºå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå°ç¤¾ä¼šï¼Œæ¡Œé¢æ‘Šå¼€åå‡ ä¸ªäººï¼Œå¯èƒ½æ‰®æ¼”äº†ç¤¾ä¼šä¸­çš„å„ç±»è§’è‰²ã€‚</p> <p>å½“ç„¶ä¹Ÿæœ‰ä¸€äº›â€œé«˜ç«¯å±€â€å­˜åœ¨ï¼Œä½†æ˜¯é…’åœºæ–‡åŒ–æœ¬èº«å°±æ˜¯ç¤¾ä¼šæ–‡åŒ–ã€æ°›å›´çš„å½±å°„ï¼Œä½ æ‰€å¤„çš„ç¤¾ä¼šå’Œä½ æ‰€åœ¨çš„é…’åœºè«åé—´æœ‰ä¸€äº›è”ç³»ã€‚æ‰€ä»¥æˆ‘è§‰å¾—åŒæ¶é…’åœºæ–‡åŒ–æœ¬èº«ä¹Ÿå˜å¾—å¾ˆæ„ŸåŒèº«å—ã€‚ä¸è¿‡å‡¡äº‹å‡æœ‰æ­£åé¢ï¼Œå½“ç„¶äººåœ¨ä¸€å®šçš„èŒƒå›´å’Œé™åº¦ä¹‹å†…éƒ½æœ‰é€‰æ‹©ã€‚æˆ–è®¸æˆ‘ä»¬åšæŒä¸æ‡ˆåœ°åŠªåŠ›çš„åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬å¸Œæœ›èƒ½æœ‰æ›´å¤šçš„é€‰æ‹©ã€‚</p> <p>äººæœ‰ä¸»è§‚èƒ½åŠ¨æ€§ï¼Œäººæœ‰æ¬²æœ›å’Œæƒ³æ³•ï¼Œå¦‚æœä½ èƒ½åœ¨åšå†³å®šä¹‹å‰æ€è€ƒæ¸…æ¥šå¹¶ä¸”å¯¹è‡ªå·±çš„å†³å®šè´Ÿè´£ï¼Œé‚£ä¹ˆæˆ‘è§‰å¾—åœ¨å¾ˆå¤šæ—¶å€™ï¼Œä¸ç®¡é¢å¯¹çš„å±€é¢æ˜¯å¥½æ˜¯åï¼Œèƒ½æ›´åŠ ä»å®¹çš„é¢å¯¹ã€‚è¿™ä¸€åˆ‡çš„ç¼˜ç”±æœ¬å°±æ˜¯äººå¿ƒå’Œåº•æ°”ğŸº</p>]]></content><author><name></name></author><category term="opinions"/><category term="thoughts"/><summary type="html"><![CDATA[ç‰›é¥®ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§„çš„å°è±¡ï¼Œå´ä¹Ÿè›®ç¬¦åˆç°çŠ¶çš„ã€‚]]></summary></entry><entry><title type="html">Goè¯­è¨€åŸºäºbenchstatåšåŸºå‡†æµ‹è¯•ä¸æ€§èƒ½è·Ÿè¸ª</title><link href="https://ifuryst.github.io/blog/2024/benchmarking-n-performance-tracking-in-go-using-benchstat/" rel="alternate" type="text/html" title="Goè¯­è¨€åŸºäºbenchstatåšåŸºå‡†æµ‹è¯•ä¸æ€§èƒ½è·Ÿè¸ª"/><published>2024-10-27T12:56:27+00:00</published><updated>2024-10-27T12:56:27+00:00</updated><id>https://ifuryst.github.io/blog/2024/benchmarking-n-performance-tracking-in-go-using-benchstat</id><content type="html" xml:base="https://ifuryst.github.io/blog/2024/benchmarking-n-performance-tracking-in-go-using-benchstat/"><![CDATA[<h1 id="benchmark">Benchmark</h1> <p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šåšä¸€äº›åŸºå‡†æµ‹è¯•ï¼ˆBenchmarkï¼‰ï¼Œç”¨äºå»è¯„ä¼°ä¸€äº›å‡½æ•°ä¹‹é—´çš„æ€§èƒ½å·®å¼‚ï¼Œæ¯”å¦‚å¸¸è§„æƒ…å†µæˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·åšï¼š</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">slice</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"sort"</span>
	<span class="s">"testing"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">SortedIncludes</span><span class="p">(</span><span class="n">strArray</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="n">target</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="n">sort</span><span class="o">.</span><span class="n">Strings</span><span class="p">(</span><span class="n">strArray</span><span class="p">)</span>
	<span class="n">index</span> <span class="o">:=</span> <span class="n">sort</span><span class="o">.</span><span class="n">SearchStrings</span><span class="p">(</span><span class="n">strArray</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">strArray</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strArray</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="n">target</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">true</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="no">false</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">Contains</span><span class="p">[</span><span class="n">T</span> <span class="n">comparable</span><span class="p">](</span><span class="n">list</span> <span class="p">[]</span><span class="n">T</span><span class="p">,</span> <span class="n">ele</span> <span class="n">T</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">list</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">ele</span> <span class="p">{</span>
			<span class="k">return</span> <span class="no">true</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="no">false</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">BenchmarkSortedIncludes</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">SortedIncludes</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">},</span> <span class="s">"a"</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">BenchmarkContains</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">Contains</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">},</span> <span class="s">"a"</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>æˆ‘ä»¬è·‘æµ‹ä¹‹åçš„ç»“æœå¦‚ä¸‹ï¼š</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># go test -bench=. -benchmem ./slice/slice_including_test.go</span>
goos: darwin
goarch: arm64
cpu: Apple M3 Pro
BenchmarkSortedIncludes-12      60017379                21.56 ns/op            0 B/op          0 allocs/op
BenchmarkContains-12            653826099                1.877 ns/op           0 B/op          0 allocs/op
PASS
ok      command-line-arguments  3.856s
</code></pre></div></div> <p>è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯å¯ä»¥ç›´æ¥æ ¹æ®åŸºå‡†æµ‹è¯•çš„ç»“æœå¾ˆæ˜ç¡®çš„çŸ¥é“<code class="language-plaintext highlighter-rouge">Contains</code>çš„æ•ˆç‡æ˜¯æ›´å¥½çš„ã€‚</p> <p>ä½†æ˜¯åœ¨å®é™…çš„å®è·µä¸­ï¼Œä¸Šé¢è¿™ç§æ–¹å¼åªé€‚åˆæˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™å¯¹æ¯”æµ‹è¯•æœ€åé€‰ç”¨çš„è¿™æ ·ä¸€ä¸ªæƒ…å†µï¼Œä¹‹åè¿™ä¸ªåŸºå‡†æµ‹è¯•å¯¹æˆ‘ä»¬å‡ ä¹æ˜¯æ²¡æœ‰ç”¨å¤„äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆéš¾æŒç»­è·Ÿè¸ªæŸä¸ªå‡½æ•°çš„æ€§èƒ½å˜åŒ–æƒ…å†µã€‚åŸºäºè¿™ä¸ªé—®é¢˜ï¼Œbenchstatåœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯å¯ä»¥å¸®æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <h1 id="benchstat">Benchstat</h1> <p><a href="https://github.com/iFurySt/go-benchstat-demo">https://github.com/iFurySt/go-benchstat-demo</a></p> <p>è¿™ä¸€èŠ‚ç›¸å…³çš„ä»£ç å’Œå‘½ä»¤æˆ‘éƒ½æ•´ç†åœ¨è¿™ä¸ªrepoé‡Œäº†</p> <blockquote> <p>Benchstat computes statistical summaries and A/B comparisons of Go benchmarks.</p> </blockquote> <p>ç®€è€Œè¨€ä¹‹ï¼Œbenchstatå°±æ˜¯ç”¨æ¥åšåŸºå‡†æµ‹è¯•å¯¹æ¯”çš„ï¼Œå¯ä»¥æ˜¯ä¸€æ¬¡æ”¹åŠ¨çš„å‰åå¯¹æ¯”ï¼Œä¹Ÿå¯ä»¥æ˜¯å’Œå†å²çš„æŸæ¬¡å¯¹æ¯”ã€‚è¿™æ ·å…¶å®æ˜¯å¯ä»¥æŒç»­è·Ÿè¸ªæ€§èƒ½å˜åŒ–çš„</p> <p>è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªä¸šåŠ¡è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„é€»è¾‘ï¼š</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"github.com/ifuryst/go-benchstat-demo/pkg/util"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">mockBiz</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">mockBiz</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ss</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">}</span>
	<span class="n">s1</span> <span class="o">:=</span> <span class="s">"a"</span>
	<span class="n">isInclude</span> <span class="o">:=</span> <span class="n">util</span><span class="o">.</span><span class="n">Includes</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Is %s in %v? %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">isInclude</span><span class="p">)</span>
	<span class="n">s2</span> <span class="o">:=</span> <span class="s">"d"</span>
	<span class="n">isInclude</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Includes</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Is %s in %v? %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">isInclude</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></div></div> <p>ç›¸å…³çš„å‡½æ•°ï¼š</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">util</span>

<span class="k">import</span> <span class="s">"sort"</span>

<span class="k">func</span> <span class="n">Includes</span><span class="p">(</span><span class="n">ss</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="n">s</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="n">sort</span><span class="o">.</span><span class="n">Strings</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
	<span class="n">index</span> <span class="o">:=</span> <span class="n">sort</span><span class="o">.</span><span class="n">SearchStrings</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">ss</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">true</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="no">false</span>
<span class="p">}</span>
</code></pre></div></div> <p>å°±æ˜¯ä¸€ä¸ªç®€å•çš„åœ¨åˆ—è¡¨é‡ŒæŸ¥æ‰¾æŸä¸ªå€¼æ˜¯å¦å­˜åœ¨ï¼Œä¸Šé¢è¿™ä¸ªæ˜¯v1.0.0çš„ç‰ˆæœ¬ï¼Œåˆ°v2.0.0äº†è¿™ä¸ªæ–¹æ³•è¢«æ”¹è¿›äº†</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">util</span>

<span class="k">import</span> <span class="s">"testing"</span>

<span class="k">func</span> <span class="n">BenchmarkInclude</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">Includes</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">},</span> <span class="s">"a"</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>è¿™ç§æƒ…å†µå…¶å®æˆ‘ä»¬å¯èƒ½ä¸çŸ¥é“æ€§èƒ½æ•´ä½“æ˜¯æ€æ ·å˜åŒ–çš„ï¼Œå› æ­¤æˆ‘ä»¬åˆ†åˆ«å¯¹bizå’ŒIncludeå¢åŠ ä¸€ä¸‹benchmark</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"os"</span>
	<span class="s">"testing"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">BenchmarkBiz</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">old</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">Stdout</span>
	<span class="n">devNull</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">DevNull</span><span class="p">)</span>
	<span class="k">defer</span> <span class="n">devNull</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
	<span class="n">os</span><span class="o">.</span><span class="n">Stdout</span> <span class="o">=</span> <span class="n">devNull</span>
	<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">os</span><span class="o">.</span><span class="n">Stdout</span> <span class="o">=</span> <span class="n">old</span> <span class="p">}()</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">mockBiz</span><span class="p">()</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>ä»¥åŠ</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">util</span>

<span class="k">import</span> <span class="s">"testing"</span>

<span class="k">func</span> <span class="n">BenchmarkInclude</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">Includes</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">},</span> <span class="s">"a"</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡go teståšåŸºå‡†æµ‹è¯•çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªç‰ˆæœ¬åˆ†åˆ«åšä¸€ä¸‹</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout v1.0.0
go <span class="nb">test</span> <span class="nt">-bench</span><span class="o">=</span><span class="nb">.</span> <span class="nt">-benchmem</span> <span class="nt">-count</span><span class="o">=</span>10 ./... <span class="o">&gt;</span> old-<span class="sb">`</span>git rev-parse HEAD<span class="sb">`</span>.txt
git checkout v2.0.0
go <span class="nb">test</span> <span class="nt">-bench</span><span class="o">=</span><span class="nb">.</span> <span class="nt">-benchmem</span> <span class="nt">-count</span><span class="o">=</span>10 ./... <span class="o">&gt;</span> new-<span class="sb">`</span>git rev-parse HEAD<span class="sb">`</span>.txt
</code></pre></div></div> <p>è¿™ä¸ªå‘½ä»¤å°±æ˜¯åšbenchmarkï¼ŒåŒæ—¶ä¹Ÿç»Ÿè®¡å†…å­˜çš„æƒ…å†µï¼Œè·‘10æ¬¡åŸºå‡†æµ‹è¯•æ˜¯ä¸ºäº†å‡å°‘ä¸€äº›è¯¯å·®ï¼Œå°†ç»“æœåˆ†åˆ«è¾“å‡ºåˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”¨benchstatå¯¹æ¯”è¿™ä¸¤ä¸ªæ–‡ä»¶</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>benchstat old-<span class="k">*</span>.txt new-<span class="k">*</span>.txt
</code></pre></div></div> <p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>goos: darwin
goarch: arm64
pkg: github.com/ifuryst/go-benchstat-demo
cpu: Apple M3 Pro
       â”‚ old-3d43a88772ed24c341f60e41122828fe38594870.txt â”‚ new-a7d9ff564525bee68aedcb03a1bf9ef5f53b3a79.txt â”‚
       â”‚                      sec/op                      â”‚          sec/op            vs base               â”‚
Biz-12                                        914.4n Â± 2%                 881.4n Â± 4%  <span class="nt">-3</span>.61% <span class="o">(</span><span class="nv">p</span><span class="o">=</span>0.007 <span class="nv">n</span><span class="o">=</span>10<span class="o">)</span>

       â”‚ old-3d43a88772ed24c341f60e41122828fe38594870.txt â”‚ new-a7d9ff564525bee68aedcb03a1bf9ef5f53b3a79.txt â”‚
       â”‚                       B/op                       â”‚             B/op              vs base            â”‚
Biz-12                                         320.0 Â± 0%                     320.0 Â± 0%  ~ <span class="o">(</span><span class="nv">p</span><span class="o">=</span>1.000 <span class="nv">n</span><span class="o">=</span>10<span class="o">)</span> Â¹
Â¹ all samples are equal

       â”‚ old-3d43a88772ed24c341f60e41122828fe38594870.txt â”‚ new-a7d9ff564525bee68aedcb03a1bf9ef5f53b3a79.txt â”‚
       â”‚                    allocs/op                     â”‚          allocs/op            vs base            â”‚
Biz-12                                         13.00 Â± 0%                     13.00 Â± 0%  ~ <span class="o">(</span><span class="nv">p</span><span class="o">=</span>1.000 <span class="nv">n</span><span class="o">=</span>10<span class="o">)</span> Â¹
Â¹ all samples are equal

pkg: github.com/ifuryst/go-benchstat-demo/pkg/util
           â”‚ old-3d43a88772ed24c341f60e41122828fe38594870.txt â”‚ new-a7d9ff564525bee68aedcb03a1bf9ef5f53b3a79.txt â”‚
           â”‚                      sec/op                      â”‚          sec/op           vs base                â”‚
Include-12                                       20.095n Â± 2%                1.881n Â± 1%  <span class="nt">-90</span>.64% <span class="o">(</span><span class="nv">p</span><span class="o">=</span>0.000 <span class="nv">n</span><span class="o">=</span>10<span class="o">)</span>

           â”‚ old-3d43a88772ed24c341f60e41122828fe38594870.txt â”‚ new-a7d9ff564525bee68aedcb03a1bf9ef5f53b3a79.txt â”‚
           â”‚                       B/op                       â”‚             B/op              vs base            â”‚
Include-12                                         0.000 Â± 0%                     0.000 Â± 0%  ~ <span class="o">(</span><span class="nv">p</span><span class="o">=</span>1.000 <span class="nv">n</span><span class="o">=</span>10<span class="o">)</span> Â¹
Â¹ all samples are equal

           â”‚ old-3d43a88772ed24c341f60e41122828fe38594870.txt â”‚ new-a7d9ff564525bee68aedcb03a1bf9ef5f53b3a79.txt â”‚
           â”‚                    allocs/op                     â”‚          allocs/op            vs base            â”‚
Include-12                                         0.000 Â± 0%                     0.000 Â± 0%  ~ <span class="o">(</span><span class="nv">p</span><span class="o">=</span>1.000 <span class="nv">n</span><span class="o">=</span>10<span class="o">)</span> Â¹
Â¹ all samples are equal

</code></pre></div></div> <p>è®©ChatGPTğŸ¤–å¸®æˆ‘ä»¬ç»„ç»‡ç¾åŒ–æˆè¡¨æ ¼å¯èƒ½æ›´å¥½çœ‹ï¼š</p> <p>Package: <code class="language-plaintext highlighter-rouge">github.com/ifuryst/go-benchstat-demo</code></p> <p>CPU: Apple M3 Pro (<code class="language-plaintext highlighter-rouge">goos: darwin</code>, <code class="language-plaintext highlighter-rouge">goarch: arm64</code>)</p> <table> <thead> <tr> <th>Test</th> <th>Metric</th> <th>Old (sec/op)</th> <th>New (sec/op)</th> <th>Change</th> <th>P-Value</th> <th>Samples</th> </tr> </thead> <tbody> <tr> <td>Biz-12</td> <td>sec/op</td> <td>914.4n Â± 2%</td> <td>881.4n Â± 4%</td> <td>-3.61%</td> <td>p=0.007</td> <td>n=10</td> </tr> <tr> <td>Biz-12</td> <td>B/op</td> <td>320.0 Â± 0%</td> <td>320.0 Â± 0%</td> <td>~ (no change)</td> <td>p=1.000</td> <td>n=10</td> </tr> <tr> <td>Biz-12</td> <td>allocs/op</td> <td>13.00 Â± 0%</td> <td>13.00 Â± 0%</td> <td>~ (no change)</td> <td>p=1.000</td> <td>n=10</td> </tr> </tbody> </table> <p>Package: <code class="language-plaintext highlighter-rouge">github.com/ifuryst/go-benchstat-demo/pkg/util</code></p> <table> <thead> <tr> <th>Test</th> <th>Metric</th> <th>Old (sec/op)</th> <th>New (sec/op)</th> <th>Change</th> <th>P-Value</th> <th>Samples</th> </tr> </thead> <tbody> <tr> <td>Include-12</td> <td>sec/op</td> <td>20.095n Â± 2%</td> <td>1.881n Â± 1%</td> <td>-90.64%</td> <td>p=0.000</td> <td>n=10</td> </tr> <tr> <td>Include-12</td> <td>B/op</td> <td>0.000 Â± 0%</td> <td>0.000 Â± 0%</td> <td>~ (no change)</td> <td>p=1.000</td> <td>n=10</td> </tr> <tr> <td>Include-12</td> <td>allocs/op</td> <td>0.000 Â± 0%</td> <td>0.000 Â± 0%</td> <td>~ (no change)</td> <td>p=1.000</td> <td>n=10</td> </tr> </tbody> </table> <p>è§£é‡Šä¸€ä¸‹è¿™å‡ ä¸ªåˆ—çš„å«ä¹‰ï¼š</p> <ul> <li>Testï¼šå¯¹åº”çš„åŸºå‡†æµ‹è¯•çš„åç§°</li> <li>Metricï¼šæµ‹é‡çš„æŒ‡æ ‡ï¼š <ul> <li>sec/opï¼šæ¯ä¸ªæ“ä½œèŠ±è´¹çš„ç§’æ•°ï¼Œç”¨æ¥è¡¡é‡å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ“ä½œæ‰€éœ€çš„æ—¶é—´ï¼Œè¶Šä½è¶Šå¥½ã€‚</li> <li>B/opï¼šæ¯ä¸ªæ“ä½œåˆ†é…çš„å­—èŠ‚æ•°ï¼Œç”¨æ¥è¡¡é‡å‡½æ•°æ‰§è¡Œæ—¶å†…å­˜åˆ†é…çš„å¤§å°ï¼Œè¶Šå°‘è¶Šå¥½ã€‚</li> <li>allocs/op: æ¯ä¸ªæ“ä½œçš„å†…å­˜åˆ†é…æ¬¡æ•°ï¼Œç”¨æ¥è¡¡é‡å‡½æ•°æ‰§è¡Œæ—¶å‘ç”Ÿäº†å¤šå°‘æ¬¡å†…å­˜åˆ†é…ï¼Œè¶Šå°‘è¶Šå¥½ã€‚</li> </ul> </li> <li>Old (sec/op)ï¼šæ—§ç‰ˆæœ¬çš„åŸºå‡†æµ‹è¯•ç»“æœå¹³å‡èŠ±è´¹æ—¶é—´å’Œè¯¯å·®èŒƒå›´</li> <li>New (sec/op):ï¼šæ–°ç‰ˆæœ¬çš„åŸºå‡†æµ‹è¯•ç»“æœ</li> <li>Changeï¼šæ–°æ—§ç‰ˆæœ¬æ€§èƒ½çš„å˜åŒ–ç™¾åˆ†æ¯”ï¼Œè´Ÿå€¼è¡¨ç¤ºæ€§èƒ½æå‡</li> <li>P-Valueï¼šç»Ÿè®¡å­¦ä¸­çš„På€¼ï¼Œç”¨æ¥è¡¡é‡ç»“æœçš„æ˜¾è‘—æ€§ï¼Œä¸€èˆ¬æ¥è¯´å°äº0.05å°±æ˜¯æ•ˆæœæ˜¾è‘—ï¼Œ1å°±æ˜¯å·®å¼‚ä¸æ˜æ˜¾</li> <li>Samplesï¼šåŸºå‡†æµ‹è¯•çš„æ ·æœ¬æ•°é‡ï¼Œè¡¨ç¤ºæ¯ä¸ªåŸºå‡†æµ‹è¯•çš„è¿è¡Œæ¬¡æ•°</li> </ul> <p>æˆ‘ä»¬å¯ä»¥å¾ˆç›´è§‚çš„ä»è¡¨æ ¼é‡Œçœ‹å‡ºï¼Œv2çš„æ—¶å€™Includeçš„æ‰§è¡Œæ—¶é—´æå‡äº†90%ï¼Œä½†æ˜¯æˆ‘ä»¬åŒæ—¶å¯ä»¥çœ‹åˆ°å¯¹äºBizæ¥è¯´æ•´ä½“å…¶å®æ˜¯æ²¡æ€ä¹ˆæå‡çš„ï¼Œè¿™é‡Œåº”è¯¥æ˜¯æ‰“å°æ—¥å¿—æŠŠæ•´ä½“çš„æ€§èƒ½éƒ½æ‹‰ä½äº†ï¼Œå¯¼è‡´å‹ä¸å‡ºæ¥</p> <p>æœ‰äº†benchstatï¼Œæˆ‘ä»¬å…¶å®æ˜¯å¯ä»¥åœ¨CIç¯èŠ‚å°±å¯ä»¥é’ˆå¯¹PRå¯¹æ¯”å‰åçš„æ€§èƒ½å˜åŒ–ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§å‘å¸ƒçš„ç‰ˆæœ¬åœ¨æ¯æ¬¡å‘ç‰ˆå‰è·Ÿè¸ªç‰ˆæœ¬é—´çš„æ€§èƒ½å·®å¼‚</p> <h1 id="references">References</h1> <ul> <li><a href="https://pkg.go.dev/golang.org/x/perf/cmd/benchstat">https://pkg.go.dev/golang.org/x/perf/cmd/benchstat</a></li> <li><a href="https://github.com/iFurySt/go-benchstat-demo">https://github.com/iFurySt/go-benchstat-demo</a></li> </ul>]]></content><author><name></name></author><category term="Coding"/><category term="Go"/><summary type="html"><![CDATA[Benchmark]]></summary></entry></feed>